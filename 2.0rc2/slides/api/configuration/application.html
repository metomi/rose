

<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Application Configuration &mdash; Rose Documentation 2.0rc2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/diff_selector.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/grid_table.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/hieroglyph_theme_addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/tutorial.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/addons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0rc2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/diff_selector.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="../../_static/js/addons.js"></script>
    <script type="text/javascript" src="../../_static/js/versioning.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="shortcut icon" href="../../_static/rose-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Rose Documentation 2.0rc2 documentation" href="../../index.html" />
    <link rel="up" title="Rose Configuration" href="index.html" />
    <link rel="next" title="Suite Configuration" href="suite.html" />
    <link rel="prev" title="Rose Configuration" href="index.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="application-configuration">

<h1>Application Configuration<a class="headerlink" href="../../../html/api/configuration/application.html#application-configuration" title="View HTML">ยง</a></h1>

<p>The configuration of an application is represented by a directory. It may
contain the following:</p>
<ul>
<li><p class="first"><a class="reference internal" href="#rose:file:rose-app.conf" title="rose:file:rose-app.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-app.conf</span></code></a> - a compulsory configuration file in the
modified INI format. It contains the following information:</p>
<ul class="simple">
<li>the command(s) to run.</li>
<li>the metadata type for the application.</li>
<li>the list of environment variables.</li>
<li>other configurations that can be represented in un-ordered <code class="docutils literal notranslate"><span class="pre">key=value</span></code>
pairs, e.g. Fortran namelists.</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">file/</span></code> directory: other input files, e.g.:</p>
<ul class="simple">
<li>FCM configuration files (requires ordering of <code class="docutils literal notranslate"><span class="pre">key=value</span></code> pairs).</li>
<li>STASH files.</li>
<li>other configuration files that require more than <code class="docutils literal notranslate"><span class="pre">section=key=value</span></code>.</li>
</ul>
<p>Files in this directory are copied to the working directory in run time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If there is a clash between a <code class="docutils literal notranslate"><span class="pre">[file:*]</span></code> section and a file under
<code class="docutils literal notranslate"><span class="pre">file/</span></code>, the setting in the <code class="docutils literal notranslate"><span class="pre">[file:*]</span></code> section takes precedence.
E.g. Suppose we have a file <code class="docutils literal notranslate"><span class="pre">file/hello.txt</span></code>. In the absence of
<code class="docutils literal notranslate"><span class="pre">[file:hello.txt]</span></code>, it will copy <code class="docutils literal notranslate"><span class="pre">file/hello.txt</span></code> to
<code class="docutils literal notranslate"><span class="pre">$PWD/hello.txt</span></code> in run time. However, if we have a
<code class="docutils literal notranslate"><span class="pre">[file:hello.txt]</span></code> section and a <code class="docutils literal notranslate"><span class="pre">source=SOURCE</span></code> setting, then it
will install the file from <code class="docutils literal notranslate"><span class="pre">SOURCE</span></code> instead. If we have
<code class="docutils literal notranslate"><span class="pre">[!file:hello.txt]</span></code>, then the file will not be installed at all.</p>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory for e.g. scripts and executables used by the application
at run time. If a <code class="docutils literal notranslate"><span class="pre">bin/</span></code> exists in the application configuration, it will
prepended to the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable at run time.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">meta/</span></code> directory for the metadata of the application.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">opt/</span></code> directory (see <a class="reference internal" href="rose-configuration-format.html#optional-configuration"><span class="std std-ref">Optional Configuration</span></a>).</p>
</li>
</ul>
<p>E.g. The application configuration directory may look like:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/
./rose-app.conf
./file/file1
./file/file2
./meta/rose-meta.conf
./opt/rose-app-extra1.conf
./opt/rose-app-extra2.conf
...
</pre></div>
</div>
</div></blockquote>
<dl class="rose file">
<dt class="sig sig-object rose" id="rose:file:rose-app.conf">
<em class="property"><span class="pre">Rose</span> <span class="pre">Configuration</span> </em><code class="sig-name descname"><span class="pre">rose-app.conf</span></code></dt>
<dd><dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf|file-install-root">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">file-install-root</span></code></dt>
<dd><p>Root level setting. Specify the root directory to install file targets
that are specified with a relative path.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf|meta">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">meta</span></code></dt>
<dd><p>Root level setting. Specify the configuration metadata for the
application. This is ignored by the application runner, but may be used
by other Rose utilities, such as <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a>.
It can be used to specify the application type.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf|mode">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">mode</span></code></dt>
<dd><p>Root level setting. Specify the name of a built-in application,
instead of running a command specified in the <a class="reference internal" href="#rose:conf:rose-app.conf[command]" title="rose:conf:rose-app.conf[command]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[command]</span></code></a>
section.</p>
<p>See also <a class="reference internal" href="../rose-built-in-applications.html#rose-built-in-applications"><span class="std std-ref">Rose Built-In Applications</span></a>.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf|opts">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">opts</span></code></dt>
<dd><p>Hardcode an optional configuration to be used by the application. It is
generally better to specify optional configurations using the
<span class="target" id="index-0"></span><a class="reference internal" href="../environment-variables.html#envvar-ROSE_APP_OPT_CONF_KEYS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ROSE_APP_OPT_CONF_KEYS</span></code></a> environment variable or
<code class="docutils literal notranslate"><span class="pre">--opt-conf-key</span></code> argument both of which work with
<a class="reference internal" href="../command-reference.html#command-rose-app-run"><span class="std std-ref">rose app-run</span></a> and <a class="reference internal" href="../command-reference.html#command-rose-task-run"><span class="std std-ref">rose task-run</span></a>.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[command]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[command]</span></code></dt>
<dd><p>Specify the command(s) to run.</p>
<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[command]default">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">default</span></code><em class="property"><span class="pre">=</span> <span class="pre">COMMAND</span></em></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Compulsory:</th><td class="field-body">True</td>
</tr>
</tbody>
</table>
<p>Specify the default command to run.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[command]ALTERNATE">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">ALTERNATE</span></code><em class="property"><span class="pre">=</span> <span class="pre">COMMAND</span></em></dt>
<dd><p>Specify an alternate command referred to by the name <code class="docutils literal notranslate"><span class="pre">ALTERNATE</span></code>
which can be selected at runtime.</p>
<p>See the <a class="reference internal" href="../../tutorial/rose/furthertopics/command-keys.html#rose-tutorial-command-keys"><span class="std std-ref">Command Keys</span></a> tutorial.</p>
</dd></dl>

</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[env]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[env]</span></code></dt>
<dd><p>Specify environment variables to be provided to the
<a class="reference internal" href="#rose:conf:rose-app.conf[command]" title="rose:conf:rose-app.conf[command]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[command]</span></code></a> at runtime.</p>
<p>The usual <code class="docutils literal notranslate"><span class="pre">$NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">${NAME}</span></code> syntax can be used in values to
reference environment variables that are already defined when the
application runner is invoked. However, it is unsafe to reference other
environment variables defined in this section.</p>
<p>If the value of an environment variable setting begins with a tilde
<code class="docutils literal notranslate"><span class="pre">~</span></code>, all of the characters preceding the first slash <code class="docutils literal notranslate"><span class="pre">/</span></code> are
considered a <em>tilde-prefix</em>. Where possible, a tilde-prefix is replaced
with the home directory associated with the specified login name at run
time.</p>
<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[env]KEY">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">KEY</span></code><em class="property"><span class="pre">=</span> <span class="pre">VALUE</span></em></dt>
<dd><p>Define an environment variable <code class="docutils literal notranslate"><span class="pre">KEY</span></code> with the value <code class="docutils literal notranslate"><span class="pre">VALUE</span></code>.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[env]UNDEF">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">UNDEF</span></code></dt>
<dd><p>A special variable that is always undefined at run time.</p>
<p>Reference to it will cause a failure at run time. It can be used to
indicate that a value must be overridden at run time.</p>
</dd></dl>

</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[etc]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[etc]</span></code></dt>
<dd><p>Specify misc. settings.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Currently, only UM defs for science sections are
thought to require this section.</p>
</div>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[file:TARGET]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[file:TARGET]</span></code></dt>
<dd><p>Specify a file/directory to be installed. <code class="docutils literal notranslate"><span class="pre">TARGET</span></code> should be a path
relative to the run time <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> or <code class="docutils literal notranslate"><span class="pre">STDIN</span></code>.</p>
<p>E.g. <code class="docutils literal notranslate"><span class="pre">file:app/APP=source=LOCATION</span></code>.</p>
<p>For a list of configuration options see <a class="reference internal" href="file-creation.html#rose:conf:*[file:TARGET]" title="rose:conf:*[file:TARGET]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">*[file:TARGET]</span></code></a> for
details.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[namelist:NAME]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[namelist:NAME]</span></code></dt>
<dd><p>Specify a Fortran namelist with the group name called <code class="docutils literal notranslate"><span class="pre">NAME</span></code>, which
can be referred to by a <a class="reference internal" href="file-creation.html#rose:conf:*[file:TARGET]source" title="rose:conf:*[file:TARGET]source"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">*[file:TARGET]source</span></code></a> setting of
a file.</p>
<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[namelist:NAME]KEY">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">KEY</span></code><em class="property"><span class="pre">=</span> <span class="pre">VALUE</span></em></dt>
<dd><p>Define a new namelist setting <code class="docutils literal notranslate"><span class="pre">KEY</span></code> set to <code class="docutils literal notranslate"><span class="pre">VALUE</span></code> exactly like a
Fortran namelist, but without the trailing comma.</p>
</dd></dl>

<p>Namelists can be grouped in two ways:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">[namelist:NAME(SORT-INDEX)]</span></code><ul>
<li>This allows different namelist files to have namelists with the same
group name. These will all inherit the same group configuration
metadata (from <code class="docutils literal notranslate"><span class="pre">[namelist:NAME]</span></code>).</li>
<li>This allows the <code class="docutils literal notranslate"><span class="pre">source</span></code> setting of a file to refer to all
<code class="docutils literal notranslate"><span class="pre">[namelist:NAME(SORT-INDEX)]</span></code> as <code class="docutils literal notranslate"><span class="pre">namelist:NAME(:)</span></code>, and the
namelist groups will be sorted alphanumerically by the
<code class="docutils literal notranslate"><span class="pre">SORT-INDEX</span></code>.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">[namelist:NAME{CATEGORY}]</span></code><ul>
<li>This allows the same namelist
to have different usage and configuration metadata according to its
category. Namelists will inherit configuration metadata from their
basic group <code class="docutils literal notranslate"><span class="pre">[namelist:NAME]</span></code> as well as from their specific
category <code class="docutils literal notranslate"><span class="pre">[namelist:NAME{CATEGORY}]</span></code>.</li>
</ul>
</li>
</ol>
<p>These groupings can be combined: <code class="docutils literal notranslate"><span class="pre">[namelist:NAME{CATEGORY}(SORT-INDEX)]</span></code></p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">[poll]</span></code></dt>
<dd><p>Specify prerequisites to poll for before running the actual application.
Three types of tests can be performed:</p>
<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]all-files">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">all-files</span></code></dt>
<dd><p>A list of space delimited list of file paths. This test
passes only if all file paths in the list exist. Accepts globs.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]any-files">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">any-files</span></code></dt>
<dd><p>A list of space delimited list of file paths. This test
passes if any file path in the list exists. Accepts globs.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]test">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">test</span></code></dt>
<dd><p>A shell command. This test passes if the command returns a 0
(zero) return code.</p>
<p>This test is run in addition to
the <a class="reference internal" href="#rose:conf:rose-app.conf[poll]all-files" title="rose:conf:rose-app.conf[poll]all-files"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">all-files</span></code></a> and <a class="reference internal" href="#rose:conf:rose-app.conf[poll]any-files" title="rose:conf:rose-app.conf[poll]any-files"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">any-files</span></code></a>
tests for the existence of file paths.</p>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]file-test">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">file-test</span></code></dt>
<dd><p>A shell command run for each file path, where <code class="docutils literal notranslate"><span class="pre">{}</span></code> is substituted
for the file path at runtime. This test passes if the command returns
a 0 (zero) return code for all paths in <code class="docutils literal notranslate"><span class="pre">all-files</span></code>
and any path in <code class="docutils literal notranslate"><span class="pre">any-files</span></code>.</p>
<p>If <a class="reference internal" href="#rose:conf:rose-app.conf[poll]test" title="rose:conf:rose-app.conf[poll]test"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">test</span></code></a> is not enough, e.g. you want to test for the
existence of a string in each file, you can specify a
<a class="reference internal" href="#rose:conf:rose-app.conf[poll]file-test" title="rose:conf:rose-app.conf[poll]file-test"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">file-test</span></code></a> to do a <code class="docutils literal notranslate"><span class="pre">grep</span></code>. E.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">all-files</span><span class="o">=</span><span class="s">file1 file2</span>
<span class="nv">file-test</span><span class="o">=</span><span class="s">test -e {} &amp;&amp; grep -q &#39;hello&#39; {}</span>
</pre></div>
</div>
<p>At runtime, any <code class="docutils literal notranslate"><span class="pre">{}</span></code> in the command is replaced
with the name of the file (or glob pattern).
The example above tests that both
<code class="docutils literal notranslate"><span class="pre">file1</span></code> and <code class="docutils literal notranslate"><span class="pre">file2</span></code> exist and that they both contain the
string <code class="docutils literal notranslate"><span class="pre">hello</span></code>. It is run for each path/pattern, so the
example above would be equivalent to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">test</span> -e file1 <span class="o">&amp;&amp;</span> grep -q <span class="s1">&#39;hello&#39;</span> file1
<span class="nb">test</span> -e file2 <span class="o">&amp;&amp;</span> grep -q <span class="s1">&#39;hello&#39;</span> file2
</pre></div>
</div>
</dd></dl>

<dl class="rose conf">
<dt class="sig sig-object rose" id="rose:conf:rose-app.conf[poll]delays">
<em class="property"><span class="pre">Config</span> </em><code class="sig-name descname"><span class="pre">delays</span></code></dt>
<dd><p>The above tests will only be performed once when the application
runner starts. If a list of <a class="reference internal" href="#rose:conf:rose-app.conf[poll]delays" title="rose:conf:rose-app.conf[poll]delays"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">delays</span></code></a> are added, the tests
will be performed a number of times with delays between them. If the
prerequisites are still not met  after the number of delays, the
application runner will fail with a time out. The list is a
comma-separated list. The syntax looks like <code class="docutils literal notranslate"><span class="pre">[n*][DURATION]</span></code>,
where <code class="docutils literal notranslate"><span class="pre">DURATION</span></code> is an
<a class="reference external" href="https://cylc.github.io/cylc-doc/latest/html/tutorial/scheduling/datetime-cycling.html#tutorial-iso8601-durations" title="(in Cylc v8.0rc1)"><span class="xref std std-ref">ISO8601 duration</span></a> such as
<code class="docutils literal notranslate"><span class="pre">PT5S</span></code> (5 seconds) or <code class="docutils literal notranslate"><span class="pre">PT10M</span></code> (10 minutes), and <code class="docutils literal notranslate"><span class="pre">n</span></code> is
an optional number of times to repeat it. E.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default</span>
<span class="nv">delays</span><span class="o">=</span><span class="s">PT0S</span>

<span class="c1"># Poll 1 minute after the runner begins, repeat every minute 10 times</span>
<span class="nv">delays</span><span class="o">=</span><span class="s">10*PT1M</span>

<span class="c1"># Poll when runner begins,</span>
<span class="c1"># repeat every 10 seconds 6 times,</span>
<span class="c1"># repeat every minute 60 times,</span>
<span class="c1"># repeat once after 1 hour</span>
<span class="nv">delays</span><span class="o">=</span><span class="s">PT0S,6*PT10S,60*PT1M,PT1H</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</dd></dl>





</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>