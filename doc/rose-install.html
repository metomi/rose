<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Rose: Installation</title>
  <meta name="author" content="Rose Team, Met Office, UK" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="icon" href="rose-icon.png" type="image/png" />
  <link rel="shortcut icon" href="rose-icon.png" type="image/png" />
  <link rel="stylesheet" type="text/css" href="rose-doc.css" />
  <script type="text/javascript" src="jquery.min.js">
</script>
  <script type="text/javascript" src="rose-doc.js">
</script>
  <script type="text/javascript" src="rose-version.js">
</script>
</head>

<body>
  <div class="header-footer" id="body-header">
    <address>
      &copy; British Crown Copyright 2012-3 <a href=
      "http://www.metoffice.gov.uk">Met Office</a>. See <a href=
      "rose-terms-of-use.html">Terms of Use</a>.<br />
      This document is released under the <a href=
      "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
      "license">Open Government Licence</a>.<br />
      <span id="rose-version"></span>
    </address><img id="rose-icon" src="rose-icon.png" alt="Rose" />

    <p><a href=".">Rose Documentation</a></p>
  </div>

  <div id="body-main">
    <h1>Rose: Installation</h1>

    <div id="content"></div>

    <h2 id="requirements">System Requirements</h2>

    <p>The main utilities of Rose are intended to run on a Unix/Linux system.
    They are known to work on RHEL-6. A limited set of the Rose utilities are
    known to work on AIX-7.1. Web based Rose utilities require a web browser
    compliant to XHTML 1.0, JavaScript 1.8 and CSS 2.1.</p>

    <p>The source code for Rose is available via <a href=
    "https://github.com/metomi/rose">github</a>. You can download a compressed
    tar file containing the <a href=
    "https://github.com/metomi/rose/archive/master.tar.gz">latest version</a>
    or a <a href="https://github.com/metomi/rose/tags">released version</a>. To
    install Rose, un-pack the tar file into an appropriate location on your
    system. Add the <samp>bin/</samp> directory into your <var>PATH</var>
    environment variable. Once you have done this you should now have access to
    the Rose user utilities, assuming that you have met the requirements
    described below:</p>

    <dl>
      <dt><a href="http://www.gnu.org/software/bash/">GNU Bash</a></dt>

      <dd>
        <p><dfn>used by:</dfn> <code>rose</code>.</p>

        <p><dfn>tested with version:</dfn> 4.</p>
      </dd>

      <dt><a href="http://www.python.org/">Python</a></dt>

      <dd>
        <p><dfn>used by:</dfn> <code>rose</code>.</p>

        <p><dfn>tested with version:</dfn> 2.6.</p>
      </dd>

      <dt>Python: <a href="http://pygtk.org">PyGTK</a></dt>

      <dd>
        <p><dfn>used by:</dfn> <code>rose config-edit</code> and <code>rosie
        go</code>.</p>

        <p><dfn>tested with version:</dfn> 2.18.9.</p>

        <p><dfn>minimum version required:</dfn> 2.12 (some degraded
        functionality with versions prior to 2.16).</p>
      </dd>

      <dt>Python: <a href="http://www.cherrypy.org/">cherrypy</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie web service.</p>

        <p><dfn>tested with version:</dfn> 3.2.2</p>
      </dd>

      <dt>Python: <a href="http://jinja.pocoo.org/">jinja2</a></dt>

      <dd>
        <p><dfn>used by:</dfn> <code>rose suite-run</code>, <code>rose
        macro</code>, Rosie web service.</p>

        <p><dfn>tested with version:</dfn> 2.6.</p>

        <p><dfn>minimum version required:</dfn> 2.6.</p>
      </dd>

      <dt>Python: <a href="http://docs.python-requests.org/">requests</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie web service client.</p>

        <p><dfn>tested with version:</dfn> 0.11.1.</p>

        <p><dfn>minimum version required:</dfn> 0.11.</p>
      </dd>

      <dt>Python: <a href=
      "http://github.com/simplejson/simplejson/">simplejson</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie web service and its client.</p>

        <p><dfn>tested with version:</dfn> 2.0.9.</p>

        <p><dfn>minimum version required:</dfn> 1.1.</p>
      </dd>

      <dt>Python: <a href="http://www.sqlalchemy.org">sqlalchemy</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie web service.</p>

        <p><dfn>tested with version:</dfn> 0.7.6.</p>

        <p><dfn>minimum version required:</dfn> 0.6.9.</p>
      </dd>

      <dt><a href="http://cylc.github.com/cylc/">cylc</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rose, as the supported suite engine.</p>

        <p><dfn>tested with version:</dfn> HEAD.</p>

        <p><dfn>minimum version required:</dfn> 5.1.0</p>

        <p><dfn>additional requirements:</dfn> Pyro 3, Pygraphviz (for details
        see the <a href="http://cylc.github.com/cylc/#requirements">cylc
        documentation</a>).</p>
      </dd>

      <dt><a href="http://subversion.apache.org/">Subversion</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie, as the version control system.</p>

        <p><dfn>tested with version:</dfn> 1.6.</p>

        <p><dfn>minimum version required:</dfn> 1.6.</p>
      </dd>

      <dt><a href=
      "http://www.metoffice.gov.uk/research/collaboration/fcm/">FCM</a></dt>

      <dd>
        <p><dfn>used by:</dfn> Rosie, as the normal wrapper on top of
        Subversion; <code>rose suite-run</code> recognises FCM location
        keywords in file configurations; <code>rose app-run</code> has built-in
        applications for running <code>fcm make</code>.</p>

        <p><dfn>tested with version:</dfn> HEAD.</p>

        <p><dfn>minimum version required:</dfn> 2.3.</p>
      </dd>
    </dl>

    <h2 id="hosts">Host Requirements</h2>

    <p>Whilst you can install and use Rose &amp; cylc on a single host (i.e.
    machine), most installations are likely to be more complex. There are
    actually four sets of hosts to consider when installing Rose &amp; cylc.
    Each host has slightly different requirements as follows:</p>

    <dl>
      <dt>1. Hosts for Rosie Subversion repositories and the Rosie web
      services.</dt>

      <dd>
        <p>Typically you'll only need a single host but you can have multiple
        repositories on different hosts if you require this.</p>

        <p><dfn>Installation requirements:</dfn></p>

        <ul>
          <li>Rose, Bash, Python, cherrypy, jinja2, simplejson, sqlalchemy,
          Subversion.</li>
        </ul>
      </dd>

      <dt>2. Hosts for running Cylc suites.</dt>

      <dd>
        <p>Each user can just run their suites on the host where they issue the
        <code>rose suite-run</code> command. However, the local host may not
        meet the necessary requirements for connectivity (to the hosts running
        the tasks) or for availability (the host needs to remain up for the
        duration of the suite). Therefore, Rose can be configured to run the
        suites on remote hosts. If multiple hosts are available, the least
        loaded of the available hosts will be used.</p>

        <p><dfn>Installation requirements:</dfn></p>

        <ul>
          <li>Rose, cylc, Bash, Python, jinja2, Pyro.</li>

          <li>Subversion &amp; FCM (only if you want rose suite-run to install
          files from Subversion using FCM keywords).</li>
        </ul>

        <p><dfn>Connectivity requirements:</dfn></p>

        <ul>
          <li>Must be able to submit tasks to the hosts which run the suite
          tasks, either directly or via ssh access to another host.</li>
        </ul>
      </dd>

      <dt>3. Hosts for running tasks in suites.</dt>

      <dd>
        <p><dfn>Installation requirements:</dfn></p>

        <ul>
          <li>Rose, cylc, Bash, Python.</li>

          <li>Subversion &amp; FCM (only if you want to use the Rose install
          utility to install files from Subversion using FCM keywords).</li>

          <li>Pyro (unless you configure cylc to use ssh for task
          communication).</li>
        </ul>

        <p><dfn>Connectivity requirements:</dfn></p>

        <ul>
          <li>Must be able to communicate back to the hosts running the cylc
          suites via Pyro or ssh.</li>
        </ul>
      </dd>

      <dt>4. Hosts for running user interactive tools.</dt>

      <dd>
        <p><dfn>Installation requirements:</dfn></p>

        <ul>
          <li>Rose, cylc, Bash, Python, requests, simplejson, Subversion, FCM,
          Pyro, Pygraphviz (+ graphviz), PyGTK (+ GTK).</li>
        </ul>

        <p><dfn>Connectivity requirements:</dfn></p>

        <ul>
          <li>Must have HTTP access to the hosts running the Rosie web
          service.</li>

          <li>Must have access to the Rosie Subversion repositories via the
          appropriate protocol.</li>

          <li>Must have ssh access to the hosts running the cylc suites.</li>

          <li>Must share user accounts and $HOME directories with the hosts
          running the cylc suites.</li>
        </ul>
      </dd>
    </dl>

    <p>Note: this section has assumed that you wish to use Rose &amp; cylc
    (including their respective GUIs) and use Rosie to store your suites.
    However, there are many ways of using Rose. For instance:</p>

    <ul>
      <li>You can use Rose without using cylc.</li>

      <li>You can Rose &amp; cylc but not use Rosie.</li>

      <li>You can use Rose &amp; cylc from the command line without using their
      GUIs.</li>
    </ul>

    <p>Hopefully the detailed system requirements section above should help you
    to determine what is needed according to your particular usage.</p>

    <h2 id="rose">Configuring Rose</h2>

    <p><samp>lib/bash/rose_init_site/</samp>: If you do not have root access to
    install the required Python libraries, you may need to edit this file to
    ensure Python libraries are included in the <var>PYTHONPATH</var>
    environment variable.</p>

    <p><samp>etc/rose.conf</samp>: You should edit this file to meet the
    requirement of your site.</p>

    <h2 id="rosie">Configuring Rosie</h2>

    <p>Rosie is the optional suite storage and discovery system.</p>

    <p>Rosie stores suites using Subversion repositories, with a web interface
    for suite discovery and lookup. You'll need to select a machine to host the
    Subversion repositories. This machine will also host the web server and
    databases.</p>

    <p>Login to your host, create one or more Subversion FSFS repositories.</p>

    <p>If you want to use <a href=
    "http://www.metoffice.gov.uk/research/collaboration/fcm">FCM</a> for your
    version control, you should set a special property on the repository to
    allow branching and merging with FCM in the Rosie convention. For a given
    <samp>HOST</samp> (e.g. myhost001) and a given repository root name
    <samp>NAME</samp> (e.g. roses_mo1), change into a new directory and enter
    the following commands:</p>
    <pre>
svn co -q svn://${HOST}/${NAME}/
svn ps fcm:layout -F - ${NAME} &lt;&lt;'__FCM_LAYOUT__'
depth-project = 5
depth-branch = 1
depth-tag = 1
dir-trunk = trunk
dir-branch =
dir-tag =
level-owner-branch =
level-owner-tag =
template-branch =
template-tag =
__FCM_LAYOUT__
svn ci -m 'fcm:layout: defined.' ${NAME}
rm -rf ${NAME}
</pre>

    <p>Add the following hook scripts to the repository:</p>

    <dl>
      <dt><code>pre-commit</code></dt>

      <dd>
        <pre>
#!/bin/bash
exec $ROSE_HOME/sbin/rosa svn-pre-commit "$@"
</pre>
      </dd>

      <dt><code>post-commit</code></dt>

      <dd>
        <pre>
#!/bin/bash
exec $ROSE_HOME/sbin/rosa svn-post-commit "$@"
</pre>
      </dd>
    </dl>

    <p>where <var>$ROSE_HOME</var> the root of your Rose installation.</p>

    <p>Edit the <var>[rosie-*]</var> settings in <samp>etc/rose.conf</samp> to
    point to your host machine and relevant paths such as the location for your
    repository and database.</p>

    <p>Once you have done that, create the Rosie database by running:</p>
    <pre>
$ROSE_HOME/sbin/rosa db-create
</pre>

    <p>Make sure that the account that runs the repository hooks has read/write
    access to the database and database directory.</p>

    <p>You can start the built in web service by running:</p>
    <pre>
setsid sbin/rosa ws 0/dev/null 2&gt;&amp;1 &amp;
</pre>

    <p>Alternatively you can run the Rosie web service under Apache mod_wsgi.
    To do this you will need to set up an Apache module configuration file
    (typically in <samp>/etc/httpd/conf.d/rosie-wsgi.conf</samp>) containing
    the following (with the paths set appropriately):</p>
    <pre>
SetEnv ROSE_HOME /path/to/rose
SetEnv ROSE_NS rosa
SetEnv ROSE_UTIL ws

WSGIPythonPath /path/to/rose/lib/python
WSGIScriptAlias /rosie /path/to/rose/lib/python/rosie/ws.py
</pre>

    <p>Use the Apache log at <samp>/var/log/httpd/</samp> to debug
    problems.</p>

    <p>Hopefully, you should now have a working Rosie service. You can test it
    by running:</p>
    <pre>
rosie create
</pre>

    <p>which will create the first suite in your repository, with an ID ending
    in <samp>aa001</samp> - e.g. <samp>mo1-aa001</samp>. Locate it by
    running:</p>
    <pre>
rosie lookup 001
</pre>

    <h3 id="rosie-special-suite">ROSIE special suite</h3>

    <p>You can define a special suite in each Rosie repository that provides
    some additional repository-specific data and metadata. The suite ID will
    end with <samp>ROSIE</samp> - e.g. <samp>mo1-ROSIE</samp>.</p>

    <p>This can be created by running <code>rosie create
    --meta-suite</code>.</p>

    <h4 id="rosie-special-suite-known-keys">Creating a Known Keys File</h4>

    <p>You can extend the list of search keys used in the Rosie discovery
    interfaces (such as <code>rosie go</code>). Create a text file at the root
    of a <samp>ROSIE</samp> suite working copy called
    <samp>rosie-keys</samp>.</p>

    <p>Add a space-delimited list of search keys into the file - for
    example:</p>
    <pre>
sub-project experiment model
</pre>

    <p>Run <code>fcm add -c</code> and <code>fcm commit</code>. After the
    commit, these will be added to the list of Rosie interface search keys.</p>

    <p>You can continue to modify the list by changing the file contents and
    committing.</p>

    <h2 id="meta">Storing Configuration Metadata</h2>

    <p>Some <a href="rose-configuration.html#meta">configuration metadata</a>
    will need to be centrally stored in a globally readable location. Projects
    using Rose will usually have metadata stored under a <samp>rose-meta</samp>
    directory in their source tree, and this needs to be centrally located in
    order to be retrieved by Rose utilities such as the config editor.</p>

    <p>Each sub-directory under a <samp>rose-meta</samp> directory needs to be
    replicated under a central location. The central location should be stored
    as the value of the site configuration <samp>meta-path</samp> option.</p>

    <p>For full details, see <a href=
    "rose-configuration.html#appendix-metadata-location">Metadata
    Location</a>.</p>
  </div>
</body>
</html>
