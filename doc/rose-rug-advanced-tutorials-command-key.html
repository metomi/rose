<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Rose Advanced Tutorial: suicide triggers</title>
  <meta name="author" content="Rose Team, Met Office, UK" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="defaultView" content="outline" />
  <meta name="controlVis" content="visible" />
  <link rel="stylesheet" href="S5/slides.css" type="text/css" media=
  "projection" id="slideProj" />
  <link rel="stylesheet" href="S5/outline-rose.css" type="text/css" media=
  "screen" id="outlineStyle" />
  <link rel="stylesheet" href="S5/opera.css" type="text/css" media="projection"
  id="operaFix" />
  <link rel="stylesheet" type="text/css" href=
  "google-code-prettify/prettify.css" />
  <link rel="icon" href="rose-icon.png" type="image/png" />
  <link rel="shortcut icon" href="rose-icon.png" type="image/png" />
  <script src="S5/slides.js" type="text/javascript">
</script>
  <script type="text/javascript" src="jquery.min.js">
</script>
  <script type="text/javascript" src="google-code-prettify/prettify.js">
</script>
  <script type="text/javascript" src="prettify-rose-conf.js">
</script>
  <script type="text/javascript" src="prettify-cylc-suite-rc.js">
</script>
  <script type="text/javascript" src="rose-doc.js">
</script>
  <script type="text/javascript" src="rose-version.js">
</script>
</head>

<body>
  <div class="header-footer" id="body-header">
    <address>
      &copy; British Crown Copyright 2012-3 <a href=
      "http://www.metoffice.gov.uk">Met Office</a>. See <a href=
      "rose-terms-of-use.html">Terms of Use</a>.<br />
      This document is released under the <a href=
      "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
      "license">Open Government Licence</a>.<br />
      <span id="rose-version"></span>
    </address>

    <div class="rose-link">
      <img id="rose-icon" src="rose-icon.png" alt="Rose" />

      <p><a id="doc-home-link" href="." name="doc-home-link">Rose
      Documentation</a></p>
    </div>

    <div id="currentSlide">
      <!-- DO NOT EDIT -->
    </div>

    <div id="controls">
      <!-- DO NOT EDIT -->
    </div>

    <div class="header-footer" id="footer"></div>
  </div>

  <div id="body-main" class="presentation">
    <div class="slide">
      <h1>Rose Advanced Tutorial: alternate commands</h1>
    </div>

    <div class="handout" id="content"></div>

    <div class="slide">
      <h2 id="intro">Introduction</h2>

      <p>This tutorial walks you through using command keys.</p>

      <p>Command keys allow you to specify and run different commands for 
      an app.</p>
    </div>

    <div class="slide">
      <h2 id="purpose">Purpose</h2>

      <p>Command keys can be used to specify different ways of running a 
      particular app.</p>
      
      <p>They work just like the default command for an app but have to be 
      explicitly called by the command scripting of a task.</p>

    </div>

    <div class="slide">
      <h2 id="example-task">Example</h2>

      <p>Create a <a href="rose-rug-brief-tour#cli">new suite</a> (or just a
      new directory somewhere - e.g. in your homespace) containing a blank
      <samp>rose-suite.conf</samp> and a <samp>suite.rc</samp> file that looks
      like this:</p>
      <pre class="prettyprint lang-cylc">
[scheduling]
    [[dependencies]]
        graph = "gather_ingredients =&gt; breadmaker"
        
[runtime]
    [[root]]
        [[[event hooks]]]
            succeeded handler = "rose suite-hook"
    [[gather_ingredients]]
        command scripting = "sleep 10; echo 'Done'"
    [[breadmaker]]
        command scripting = "rose task-run"        
</pre>
    </div>

    <div class="slide">
      <h3 class="alwayshidden">Example (2)</h3>
      
      <p>In your suite directory create an <samp>app</samp> directory.</p>
      <p>In the <samp>app</samp> directory create a new directory called
      <samp>breadmaker</samp>.</p>
      <p>In the <samp>breadmaker</samp> directory create a 
      <samp>rose-app.conf</samp> file that looks like this:</p>
      <pre class="prettyprint lang-cylc">
[command]
default = sleep 10; echo 'fresh bread'
</pre>
    </div>
    
    <div class="slide">
      <h3 class="alwayshidden">Description</h3>

      <p>This sets up a simple suite that contains the following:</p>
      <ul>
        <li>a <samp>breadmaker</samp> app</li>
        <li>a <samp>gather_ingredients</samp> task</li>
        <li>a <samp>breadmaker</samp> task that runs the 
        <samp>breadmaker</samp> app</li>
      <ul>

    </div>


    <div class="slide">
      <h3 class="alwayshidden">Run the suite</h3>

      <p>Save your changes and run the suite using <samp>rose suite-run</samp>.
      </p>
      
      <p>Once it has finished use <samp>rose suite-log-view</samp> to view the 
      suite log. In the page that appears, click the "out" link for the 
      breadmaker task. In the page you are now take to you should see a line
      <samp>fresh bread</samp>.</p>

    </div>

    <div class="slide">
      <h2 id="adding commands">Adding alternate commands</h2>

      <p>Open the <samp>rose-app.conf</samp> file and edit to look like this:
      </p>
      
      <pre class="prettyprint lang-cylc">
[command]
default = sleep 10; echo 'fresh bread'
make_dough = sleep 8; echo 'dough for later'
timed_bread = sleep 15; echo 'fresh bread when you want it'
</pre>
    </div>

    <div class="slide">
      <h3 class="alwayshidden">Adding alternate commands (2)</h3>
      <p>Save your changes and open up your <samp>suite.rc</samp> file. Alter 
      the <samp>[[breadmaker]]</samp> task to look like this:</p>

      <pre class="prettyprint lang-cylc">
    [[breadmaker]]
        command scripting = "rose task-run --command-key='dough'"
</pre>      
    </div>

    <div class="slide">
      <h3 class="alwayshidden">Adding alternate commands (3)</h3>
      <p></p>

</pre>      
    </div>    

    
    <div class="slide">
      <h2 id="notes">Note on suicide triggers</h2> 
    
      <p>While it is possible to have a task suicide triggering itself this is 
      not recommended and may lead to difficulties if manual interaction with 
      the suite is required to correct the problem (the task has been removed 
      from the suite).</p> 
      
    </div>
    
    <div class="slide">
      <h3 class="alwayshidden">Note on suicide triggers (2)</h2> 
          
      <p>Depending on your needs, possible places to put the suicide trigger 
      are:</p>
      <ul>
        <li>triggering off the success of a recovery task</li>
        <li>triggering off the final task in a cycle</li>
        <li>triggering off a cleanup task in the suite</li>
      </ul>    
    </div>
    
  </div>
</body>
</html>
