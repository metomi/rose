<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Rose Reference Guide: Configuration</title>
  <meta name="author" content="Rose Team, Met Office, UK" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="icon" href="rose-icon.png" type="image/png" />
  <link rel="shortcut icon" href="rose-icon.png" type="image/png" />
  <link rel="stylesheet" type="text/css" href="rose-doc.css" />
  <link rel="stylesheet" type="text/css" href=
  "google-code-prettify/prettify.css" />
  <script type="text/javascript" src="jquery.min.js">
</script>
  <script type="text/javascript" src="google-code-prettify/prettify.js">
</script>
  <script type="text/javascript" src="prettify-rose-conf.js">
</script>
  <script type="text/javascript" src="rose-doc.js">
</script>
  <script type="text/javascript" src="rose-version.js">
</script>
</head>

<body>
  <div class="header-footer" id="body-header">
    <address>
      &copy; British Crown Copyright 2012-4 <a href=
      "http://www.metoffice.gov.uk">Met Office</a>. See <a href=
      "rose-terms-of-use.html">Terms of Use</a>.<br />
      This document is released under the <a href=
      "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
      "license">Open Government Licence</a>.<br />
      <span id="rose-version"></span>
    </address><img id="rose-icon" src="rose-icon.png" alt="Rose" />

    <p><a href=".">Rose Documentation</a></p>
  </div>

  <div id="body-main">
    <h1>Rose Reference Guide: Configuration</h1>

    <div id="content"></div>

    <h2 id="goals">Goals</h2>

    <p>Suite configurations should be portable between users (at least at the
    same site). E.g.: another user should be able to run the same suite:</p>

    <ul>
      <li>without making ANY changes to it.</li>

      <li>without having to add/modify things in their $HOME/.profile.</li>
    </ul>

    <p>Input configurations should be programming language neutral.</p>

    <ul>
      <li>Any processing logic should be application/version independent,
      generic and future proof.</li>

      <li>Data structure should be represented in formats easily understood and
      manipulatable by a human and a computer.</li>
    </ul>

    <p>The life cycles of application configurations in a suite may differ from
    that of the suite.</p>

    <ul>
      <li>The configuration of an application may be independent of the
      suite.</li>

      <li>The configuration of an application should be portable between
      suitable suites.</li>
    </ul>

    <p>The configurations are independent of the utilities. For example, the
    configuration metadata for the suite and application configurations will
    drive the Rose config editor GUI, but will not be bound or restricted by
    it.</p>

    <h2 id="format">Configuration Format</h2>

    <p>A configuration in Rose is normally represented by a directory with the
    following:</p>

    <ul>
      <li>a configuration file in a modified <a href=
      "http://en.wikipedia.org/wiki/INI_file">INI file</a> format.</li>

      <li>(optionally) files containing data that cannot easily be represented
      by the INI format.</li>
    </ul>

    <p>We have added the following conventions into our INI format:</p>

    <ol>
      <li>The file name is normally called <samp>rose*.conf</samp>, e.g.
      <samp>rose.conf</samp>, <samp>rose-app.conf</samp>,
      <samp>rose-meta.conf</samp>, etc.</li>

      <li>Only a hash <kbd>#</kbd> in the beginning of a line starts a comment.
      Empty lines and lines with only white spaces are ignored. There is no
      support for trailing comments. Comments are normally ignored when a
      configuration file is loaded. However, some comments are loaded if the
      following conditions are met:

        <ul>
          <li>Comment lines at the beginning of a configuration file up to but
          not including the 1st blank line or the 1st setting are comment lines
          associated with the file. They will re-appear at the top of the file
          when it is re-dumped.</li>

          <li>Comment lines between a blank line and the next setting, and the
          comment lines between the previous setting and the next setting are
          comments associated with the next setting. The comment lines
          associated with a setting will re-appear before the setting when the
          file is re-dumped.</li>
        </ul>
      </li>

      <li>Only the equal sign <kbd>=</kbd> is used to delimit a key-value pair
      - because the colon <kbd>:</kbd> may be used in keys of namelist
      declarations.</li>

      <li>A key-value pair declaration does not have to live under a section
      declaration. Such a declaration lives directly under the <em>root</em>
      level.</li>

      <li>Key-value pair declarations following a line with only
      <code>[]</code> are placed directly under the <em>root</em> level.</li>

      <li>Declarations are case sensitive. When dealing with case-insensitive
      inputs such as Fortran logicals or numbers in scientific notation,
      lowercase values should be used.</li>

      <li>Declarations start at column 1. Continuations start at column &gt;1.

        <ul>
          <li>Each line is stripped of leading and trailing spaces.</li>

          <li>A newline <kbd>\n</kbd> character is prefixed to each
          continuation line.</li>

          <li>If a continuation line has a leading equal sign <kbd>=</kbd>
          character, it is stripped from the line. This is useful for retaining
          leading white spaces in a continuation line.</li>
        </ul>
      </li>

      <li>A single exclamation <kbd>!</kbd> or a double exclamation
      <kbd>!!</kbd> in front of a section (i.e. <code>[!SECTION]</code>) or
      key=value pair (i.e. <code>!key=value</code>) denotes an ignored setting.

        <ul>
          <li>E.g. It will be ignored in run time but may be used by other Rose
          utilities.</li>

          <li>A single exclamation denotes a user-ignored setting.</li>

          <li>A double exclamation denotes a program-ignored setting. E.g. rose
          config-edit may use a double exclamation to switch off a setting
          according to the setting metadata.</li>
        </ul>
      </li>

      <li>If a section is declared twice in a file, the later section will
      append settings to the earlier one. If the same key in the same section
      is declared twice, the later value will override the earlier one. This
      logic applies to the state of a setting as well.</li>

      <li>Once the file is parsed, declaration ordering is insignificant. N.B.
      Do not assume order of environment variables.</li>

      <li>Values of settings accept syntax such as <code>$NAME</code> or
      <code>${NAME}</code> for environment variable substitution.</li>
    </ol>

    <p>E.g.</p>
    <pre class="prettyprint lang-rose_conf">
# This is line 1 of the comment for this file.
# This is line 2 of the comment for this file.

# This comment will be ignored.

# This is a comment for section-1.
[section-1]
# This is a comment for key-1.
key-1=value 1
# This comment will be ignored.

# This is line 1 of the comment for key-2.
# This is line 2 of the comment for key-2.
key-2=value 2 line 1
      value 2 line 2
# This is a comment for key-3.
key-3=value 3 line 1
     =    value 3 line 2 has leading identation.
     =
     =    value 3 line 3 is blank. This is line 4.

# section-2 is user-ignored.
[!section-2]
key-4=value 4
# ...

[section-3]
# key-5 is program ignored.
!!key-5=value 5
</pre>

    <p>In this document, the shorthand <code>SECTION=KEY=VALUE</code> is used
    to represent a <code>KEY=VALUE</code> pair in a <code>[SECTION]</code> of
    an INI format file.</p>

    <h2 id="opts">Optional Configuration</h2>

    <p>In a Rose configuration directory, we can add an <samp>opt/</samp>
    sub-directory for optional configuration files. Optional configuration
    files contain additional configuration, which can be selected at run time
    to override the configuration in the main <var>rose-${TYPE}.conf</var>
    file. The name of each optional configuration should follow the syntax
    <var>rose-${TYPE}-${KEY}.conf</var>, where <var>${KEY}</var> is a short
    name to describe the override functionality of the optional configuration
    file.</p>

    <p>A root level <var>opts=KEY ...</var> setting in the main configuration
    will tell the run time program to load the relevant optional configurations
    in the <samp>opt/</samp> sub-directory at run time. Individual Rose
    utilities may also read optional configuration keys from environment
    variables and/or command line options.</p>

    <p>Where multiple <var>$KEY</var> settings are given, the optional
    configurations are applied in that order - for example, a setting:</p>
    <pre class="prettyprint lang-rose_conf">
opts=ketchup mayonnaise
</pre>

    <p>implies loading the optional configuration
    <var>rose-app-ketchup.conf</var> and then the optional configuration
    <var>rose-app-mayonnaise.conf</var>, which may override the previous
    one.</p>

    <p>Some Rose utilities (e.g. <a href=
    "rose-command.html#rose-suite-run">rose suite-run</a>, <a href=
    "rose-command.html#rose-task-run">rose task-run</a>, <a href=
    "rose-command.html#rose-app-run">rose app-run</a>, etc) allows optional
    configuration to be selected at run time using:</p>
    
    <ol>
      <li>Environment variables. (See reference of individual commands for
      detail.)</li>

      <li>The command line option <code>--opt-conf-key=KEY</code> or
      <code>-O KEY</code>.</li>
    </ol>

    <h2 id="defines">Re-define Configuration at Run Time</h2>

    <p>Some Rose utilities (e.g. <a href=
    "rose-command.html#rose-suite-run">rose suite-run</a>, <a href=
    "rose-command.html#rose-task-run">rose task-run</a>, <a href=
    "rose-command.html#rose-app-run">rose app-run</a>, etc) allow you to
    re-define configuration settings at run time using the
    <code>--define=[SECTION]NAME=VALUE</code> or <code>-D
    [SECTION]NAME=VALUE</code> options on the command line. This would add new
    settings or override any settings defined in the main and optional
    configurations. E.g.:</p>

    <pre class="shell">
# Set [env]FOO=foo, and [env]BAR=bar
# (Overriding any original settings of [env]FOO or [env]BAR)
rose task-run -D '[env]FOO=foo' -D '[env]BAR=bar'

# Switch off [env]BAZ
rose task-run -D '[env]!BAZ='
</pre>

    <h2 id="site">Site and User Configuration</h2>

    <p>Aspects of some Rose utilities can be configured per installation via
    the site configuration file and per user via the user configuration file.
    Any configuration in the site configuration overrides the default, and any
    configuration in the user configuration overrides the site configuration
    and the default. Rose expects these files to be in the modified INI format
    described above. Rose utilities search for its site configuration at
    <var>$ROSE_HOME/etc/rose.conf</var> where <var>$ROSE_HOME/bin/rose</var> is
    the location of the <code>rose</code> command, and they search for the user
    configuration at <var>$HOME/.metomi/rose.conf</var> where <var>$HOME</var>
    is the home directory of the current user.</p>

    <p><em>Allowed settings in the site and user configuration files will be
    documented in a future version of this document. In the mean time, the
    settings are documented as comments in the <var>etc/rose.conf.example</var>
    file of each distribution of Rose.</em></p>

    <p>You can also override many internal constants of the <code>rose config
    edit</code> and <code>rosie go</code>. To change the keyboard shortcut of
    the <samp>Find Next</samp> action in the config editor to <kbd>F3</kbd>,
    put the following lines in your user config file, and the setting will
    apply the next time you run <code>rose config-edit</code>:</p>
    <pre class="prettyprint lang-rose_conf">
[rose-config-edit]
accel-find-next=F3
</pre>

    <h2 id="suite">Suite Configuration</h2>

    <p>The configuration and functionality of a suite will usually be covered
    by the use of <a href="http://cylc.github.io/cylc/">Cylc</a>. In which
    case, most of the suite configuration will live in the Cylc
    <samp>suite.rc</samp> file. Otherwise, a suite is just a directory of
    files.</p>

    <p>A suite directory may contain the following:</p>

    <ul>
      <li>A file called <samp>rose-suite.conf</samp>, a configuration file in
      the modified INI format described above. It stores the information on how
      to install the suite. See <a href="#suite.conf">below</a> for
      detail.</li>

      <li>A file called <samp>rose-suite.info</samp>, a configuration file in
      the modified INI format described above. It describes the suite's purpose
      and identity, e.g. the title, the description, the owner, the access
      control list, and other information. Apart from a few standard fields, a
      suite is free to store any information in this file. See <a href=
      "#suite.info">below</a> for detail.</li>

      <li>An <samp>app/</samp> directory of application configurations used by
      the suite.</li>

      <li>A <samp>bin/</samp> directory of scripts and utilities used by the
      suite.</li>

      <li>An <samp>etc/</samp> directory of other configurations and resources
      used the suite. E.g. fcm make configurations.</li>

      <li>A <samp>meta/</samp> directory containing the suite's configuration
      metadata.</li>

      <li><samp>opt/</samp> directory. For detail, see <a href="#opts">Optional
      Configuration</a>.</li>

      <li>Other items, as long as they do not clash with the scheduler's
      working directories. E.g. for a Cylc suite, <samp>log*/</samp>,
      <samp>share/</samp>, <samp>state/</samp> and <samp>work/</samp> should be
      avoided.</li>
    </ul>

    <h3 id="suite.conf">Suite Configuration: Suite Installation</h3>

    <p>The suite install configuration file <code>rose-suite.conf</code> should
    contain the information on how to install the suite. It may have the
    following sections and root level options:</p>

    <dl>
      <dt><code>[env]</code></dt>

      <dd>
        Specify the environment variables to export to the suite daemon. The
        usual <var>$NAME</var> or <var>${NAME}</var> syntax can be used in
        values to reference environment variables that are already defined
        before the suite runner is invoked. However, it is unsafe to reference
        other environment variables defined in this section. If the value of an
        environment variable setting begins with a tilde <kbd>~</kbd>, all of
        the characters preceding the 1st slash <kbd>/</kbd> are considered a
        <em>tilde-prefix</em>. Where possible, a tilde-prefix is replaced with
        the home directory associated with the specified login name at run
        time. There are 2 special environment variables which can be specified
        in this section:

        <ul>
          <li><var>ROSE_VERSION</var>: If specified, the version of Rose that
          starts the suite run must match the specified version.</li>

          <li><var>CYLC_VERSION</var>: If specified for a Cylc suite, the Rose
          suite runner will attempt to use this version of Cylc.</li>
        </ul>
      </dd>

      <dt><code>[jinja2:suite.rc]</code></dt>

      <dd>For a Cylc suite, if <a href=
      "http://jinja.pocoo.org/docs/">jinja2</a> assignments are required for
      <samp>suite.rc</samp>, they may be defined as key=value pairs in the
      <code>[jinja2:suite.rc]</code> section. The assignments will be inserted
      after the <code>#!jinja2</code> line of the installed
      <samp>suite.rc</samp> file.</dd>

      <dt><code>[file:NAME]</code></dt>

      <dd>
        Specify a file/directory to be installed. <var>NAME</var> should be a
        path relative to the run time <var>$PWD</var>.

        <ul>
          <li>E.g. <code>file:app/APP=source=LOCATION</code>.</li>

          <li>See <a href="#appendix-file-creation-mode">Appendix: File
          Creation Mode</a>.</li>
        </ul>
      </dd>
    </dl>

    <p>It may have the following top level (no section) options:</p>

    <dl>
      <dt><code>meta</code></dt>

      <dd>Specify the configuration metadata for the suite. The section may be
      used by various Rose utilities, such as the config editor GUI. It can be
      used to specify the suite type.</dd>

      <dt><code>root-dir=LIST</code></dt>

      <dd>A new line delimited list of <var>PATTERN=DIR</var> pairs. The
      <var>PATTERN</var> should be a glob-like pattern for matching a host
      name. The <var>DIR</var> should be the root directory to install a suite
      run directory. E.g.:
        <pre class="prettyprint lang-rose_conf">
root-dir=hpc*=$WORKDIR
        =*=$DATADIR
</pre>
        <p>In this example, <code>rose suite-run</code> of a suite with name
        <var>$NAME</var> will create <var>~/cylc-run/$NAME</var> as a symbolic
        link to <var>$DATADIR/cylc-run/$NAME/</var> on any machine, except those
        with their hostnames matching <var>hpc*</var>. In which case, it will
        create <var>~/cylc-run/$NAME</var> as a symbolic link to
        <var>$WORKDIR/cylc-run/$NAME/</var>.</p>
      </dd>

      <dt><code>root-dir-share=LIST</code></dt>

      <dd>A new line delimited list of <var>PATTERN=DIR</var> pairs. The
      <var>PATTERN</var> should be a glob-like pattern for matching a host
      name. The <var>DIR</var> should be the root directory where the suite's
      share directory should be created.</dd>

      <dt><code>root-dir-work=LIST</code></dt>

      <dd>A new line delimited list of <var>PATTERN=DIR</var> pairs. The
      <var>PATTERN</var> should be a glob-like pattern for matching a host
      name. The <var>DIR</var> should be the root directory where the suite's
      work directory for tasks should be created.</dd>
    </dl>

    <h3 id="suite.info">Suite Configuration: Suite Information</h3>

    <p>The suite information file <code>rose-suite.info</code> should contain
    the information on identify and the purpose of the suite. It has no
    sections, only KEY=VALUE pairs. The <var>owner</var>, <var>project</var>
    and <var>title</var> settings are compulsory. Otherwise, any KEY=VALUE
    pairs can appear in this file. If the name of a KEY ends with
    <kbd>-list</kbd>, the value is expected to be a space-delimited list. The
    following keys are known to have special meanings:</p>

    <dl>
      <dt><code>owner</code></dt>

      <dd>Specify the user ID of the owner of the suite. The owner has full
      commit access to the suite. Only the owner can delete the suite, pass the
      suite's ownership to someone else or change the access-list.</dd>

      <dt><code>project</code></dt>

      <dd>Specify the name of the project associated with the suite.</dd>

      <dt><code>title</code></dt>

      <dd>Specify a short title of the suite.</dd>

      <dt><code>access-list</code></dt>

      <dd>Specify a list of users with commit access to trunk of the suite. A
      <kbd>*</kbd> in the list means that anyone can commit to the trunk of the
      suite. Setting this blank or omitting the setting means that nobody apart
      from the owner can commit to the trunk. Only the suite owner can change
      the access list.</dd>

      <dt><code>description</code></dt>

      <dd>Specify a long description of the suite.</dd>

      <dt><code>issue-list</code></dt>

      <dd>Specify a list of ticket IDs associated with the suite.</dd>

      <dt><code>sub-project</code></dt>

      <dd>Specify a sub-division of <code>project</code>, if applicable.</dd>
    </dl>

    <h2 id="app">Application Configuration</h2>

    <p>The configuration of an application is represented by a directory. It
    may contain the following:</p>

    <ul>
      <li>
        <samp>rose-app.conf</samp>: a compulsory configuration file in the
        modified INI format. See <a href="#app.conf">below</a> for detail. It
        contains the following information:

        <ul>
          <li>the command(s) to run.</li>

          <li>the metadata type for the application.</li>

          <li>the list of environment variables.</li>

          <li>other configurations that can be represented in un-ordered
          key=value pairs, e.g. Fortran namelists.</li>
        </ul>
      </li>

      <li>
        <samp>file/</samp> directory: other input files, e.g.:

        <ul>
          <li>FCM configuration files (requires ordering of key=value
          pairs).</li>

          <li>STASH files.</li>

          <li>other configuration files that require more than
          section=key=value.</li>
        </ul>
      </li>

      <li><samp>bin/</samp> directory for e.g. scripts and executables used by
      the application at run time. If a <samp>bin/</samp> exists in the
      application configuration, it will prepended to the <var>PATH</var>
      environment variable at run time.</li>

      <li><samp>meta/</samp> directory for the metadata of the
      application.</li>

      <li><samp>opt/</samp> directory. For detail, see <a href="#opts">Optional
      Configuration</a>.</li>
    </ul>

    <p>E.g. The application configuration directory may look like:</p>
    <pre>
./bin/
./rose-app.conf
./file/file1
./file/file2
./meta/rose-meta.conf
./opt/rose-app-extra1.conf
./opt/rose-app-extra2.conf
...
</pre>

    <h3 id="app.conf">Application Configuration File</h3>

    <p>The <samp>rose-app.conf</samp> contains a serialised data structure that
    is an unordered map (sections=) of unordered maps (keys=values). There can
    also be keys=values without a section, at the top level. The sections and
    keys can be:</p>

    <dl>
      <dt><code>file-install-root</code></dt>

      <dd>Root level setting. Specify the root directory to install file
      targets that are specified with a relative path.</dd>

      <dt><code>meta</code></dt>

      <dd>Root level setting. Specify the configuration metadata for the
      application. This is ignored by the application runner, but may be used
      by other Rose utilities, such as the config editor GUI. It can be used to
      specify the application type.</dd>

      <dt><code>mode</code></dt>

      <dd>Root level setting. Specify the name of a builtin application,
      instead of running a command specified in the <code>[command]</code>
      section.</dd>

      <dt><code>[command]</code></dt>

      <dd>Specify the command(s) to run. The default key can be used to define
      the default command to run. Other keys can be used to define alternate
      commands, which can be selected at run time.</dd>

      <dt><code>[env]</code></dt>

      <dd>Specify input environment variables to the command, in KEY=VALUE
      pairs. The usual <var>$NAME</var> or <var>${NAME}</var> syntax can be
      used in values to reference environment variables that are already
      defined when the application runner is invoked. However, it is unsafe to
      reference other environment variables defined in this section. Note:
      <var>UNDEF</var> is a special variable that is always undefined at run
      time. Reference to it will cause a failure at run time. It can be used to
      indicate that a value must be overridden at run time. If the value of an
      environment variable setting begins with a tilde <kbd>~</kbd>, all of the
      characters preceding the 1st slash <kbd>/</kbd> are considered a
      <em>tilde-prefix</em>. Where possible, a tilde-prefix is replaced with
      the home directory associated with the specified login name at run
      time.</dd>

      <dt><code>[etc]</code></dt>

      <dd>Specify misc. settings. Currently, only UM defs for science sections
      are thought to require this section.</dd>

      <dt><code>[file:NAME]</code></dt>

      <dd>
        Specify a file/directory to be generated by the application runner at
        run time. <var>NAME</var> should be a path relative to the run time
        <var>$PWD</var>, or <samp>STDIN</samp>.

        <ul>
          <li>E.g. <code>file:app/APP=source=LOCATION</code>.</li>

          <li>See <a href="#appendix-file-creation-mode">Appendix: File
          Creation Mode</a>.</li>
        </ul>
      </dd>

      <dt><code>[namelist:NAME]</code></dt>

      <dd>Specify a namelist with the group name called <var>NAME</var>, which
      can be referred to by a <code>source</code> setting of a file. Each
      setting in a namelist:NAME section is a KEY=VALUE pair exactly like a
      normal Fortran namelist, but without the trailing comma.</dd>

      <dt><code>[namelist:NAME(SORT-INDEX)]</code></dt>

      <dd>
        Same as [namelist:NAME] but:

        <ul>
          <li>It allows the <code>source</code> setting of a file to refer to
          all <code>[namelist:NAME(SORT-INDEX)]</code> as
          <code>namelist:NAME(:)</code>, and the namelist groups will be sorted
          alphanumerically by the <var>SORT-INDEX</var>.</li>

          <li>It allows different namelist files to have namelists with the
          same group name. These will all inherit the same group configuration
          metadata (from <code>[namelist:NAME]</code>).</li>
        </ul>
      </dd>

      <dt><code>[namelist:NAME{CATEGORY}]</code> or
      <code>[namelist:NAME{CATEGORY}(SORT-INDEX)]</code></dt>

      <dd>
        Same as [namelist:NAME(SORT-INDEX)] but:

        <ul>
          <li>An alternate way for grouping namelists. This allows the same
          namelist to have different usage and configuration metadata according
          to its category. Namelists will inherit configuration metadata from
          their basic group <code>[namelist:NAME]</code> as well as from their
          specific category <code>[namelist:NAME{CATEGORY}]</code>.</li>
        </ul>
      </dd>

      <dt><code>[poll]</code></dt>

      <dd>
        Specify prerequisites to poll for before running the actual
        application. 3 types of tests can be performed:

        <p><var>all-files</var>: A list of space delimited list of file paths.
        This test passes only if all file paths in the list exist.</p>

        <p><var>any-files</var>: A list of space delimited list of file paths.
        This test passes if any file path in the list exists.</p>

        <p><var>test</var>: A shell command. This test passes if the command
        returns a 0 (zero) return code.</p>

        <p>Normally, the <var>all-files</var> and <var>any-files</var> tests
        both test for the existence of file paths. If this is not enough, e.g.
        you want to test for the existence of a string in each file, you can
        specify a <var>file-test</var> to do a <code>grep</code>. E.g.:</p>
        <pre class="prettyprint lang-rose_conf">
all-files=file1 file2
file-test=test -e {} &amp;&amp; grep -q 'hello' {}
</pre>

        <p>At runtime, any <code>{}</code> pattern in the above would be
        replaced with the name of the file. The above make sure that both
        <samp>file1</samp> and <samp>file2</samp> exist and that they both
        contain the string <samp>hello</samp>.</p>

        <p>The above tests will only be performed once when the application
        runner starts. If a list of <var>delays</var> are added, the tests will
        be performed a number of times with delays between them. If the
        prerequisites are still not met after the number of delays, the
        application runner will fail with a time out. The list is a
        comma-separated list. The syntax looks like <var>[R*]T[U]</var>, where
        <var>U</var> is a unit (<kbd>s</kbd> for seconds (default),
        <kbd>m</kbd> for minutes and <kbd>h</kbd> for hours), <var>T</var> is
        the number of units. E.g.:</p>
        <pre class="prettyprint lang-rose_conf">
# Default
delays=0

# Poll 1 minute after the runner begins, repeat every minute 10 times
delays=10*1m

# Poll when runner begins,
# repeat every 10 seconds 6 times,
# repeat every minute 60 times,
# repeat once after 1 hour
delays=0,6*10s,60*1m,1h
</pre>
      </dd>
    </dl>

    <h2 id="meta">Configuration Metadata</h2>

    <p>See <a href="rose-configuration-metadata.html">Configuration
    Metadata</a>.</p>

    <h2 id="appendix-file-creation-mode">Appendix: File Creation Mode</h2>

    <p>A <code>[file:TARGET]</code> section may have the following
    settings:</p>

    <dl>
      <dt><code>source</code></dt>

      <dd>A space delimited list of sources for generating this file. A source
      can be the path to a regular file or directory in the file system
      (globbing is also supported - e.g. using "*.conf" to mean all .conf
      files), or it may be a URI to a resource. If a source is a URI, it may
      point to a section with a supported scheme in the current configuration,
      e.g. a <samp>namelist:NAME</samp> section. Otherwise the URI must be in a
      supported scheme or be given sufficient information for the system to
      determine its scheme, e.g. via the root level <code>schemes</code> setting
      described below.

        <p>Normally, a source that does not exist would trigger an error in run
        time. However, it may be useful to have an optional source for a file
        sometimes. In which case, the syntax <var>source=(SOURCE)</var> can be
        used to specify an optional source. E.g. <samp>source=namelist:foo
        (namelist:bar)</samp> would allow <samp>namelist:bar</samp> to be
        missing or ignored without an error.</p>
      </dd>

      <dt><code>checksum</code></dt>

      <dd>The expected MD5 checksum of the target. If specified, the file
      generation will fail if the actual checksum of the target does not match
      with this setting. This setting is only meaningful if <var>TARGET</var>
      is a regular file or a symbolic link to a regular file. N.B. An empty
      value for checksum tells the system to report the target checksum in
      verbose mode.</dd>

      <dt><code>mode</code></dt>

      <dd><kbd>auto</kbd> (default), <kbd>mkdir</kbd> or <kbd>symlink</kbd>.
      See below.</dd>
    </dl>

    <p>The following is a list of all the supported usages:</p>

    <dl>
      <dt><code>mode=auto,source=</code></dt>

      <dd>Target is an empty file.</dd>

      <dt><code>mode=auto,source=SOURCE</code></dt>

      <dd>Target is a copy of <var>SOURCE</var>.</dd>

      <dt><code>mode=auto,source=SOURCE-LIST</code></dt>

      <dd>Target is created by concatenating the contents of
      <var>SOURCE-LIST</var>. The sources should either be all files or all
      directories.</dd>

      <dt><code>mode=mkdir</code></dt>

      <dd>Target is a directory.</dd>

      <dt><code>mode=symlink,source=SOURCE</code></dt>

      <dd>Target is created as a symlink of an FS <var>SOURCE</var>. N.B. In
      this mode, <var>SOURCE</var> must be a single source.</dd>
    </dl>

    <p>The root level <code>schemes</code> setting: While the system would
    attempt to automatically detect the scheme of a source, the name of the
    source can sometimes be ambiguous. E.g. A URL with a <samp>http</samp>
    scheme can be a path in a version control system, or a path to a plain file.
    The root level <code>schemes</code> setting can be used to help the system
    to do the right thing. The general syntax of the value of the root level
    <code>schemes</code> setting looks like:</p>
    <pre class="prettyprint lang-rose_conf">
schemes=PATTERN-1=SCHEME-1
       =PATTERN-2=SCHEME-2
</pre>

    <p>E.g.:</p>
    <pre class="prettyprint lang-rose_conf">
schemes=hpc*:*=rsync
       =http://host/svn-repos/*=svn

[file:foo.txt]
source=hpc1:/path/to/foo.txt

[file:bar.txt]
source=http://host/svn-repos/path/to/bar.txt
</pre>

    <p>In this example, a URI matching the pattern <samp>hpc*:*</samp> would
    use the <code>rsync</code> scheme to pull the source to the current host,
    and a URI matching the pattern <samp>http://host/svn-repos/*</samp> would
    use the <code>svn</code> scheme. For all other URIs, the system will try to
    make an intelligent guess.</p>

    <p>The system will always match a URI in the order as specified by the
    setting to avoid ambiguity.</p>

    <p>The system has built-in support for the following schemes:</p>

    <dl>
      <dt><code>fs</code></dt>

      <dd>The file system scheme. If a URI looks like an existing path in the
      file system, this scheme will be used.</dd>

      <dt><code>namelist</code></dt>

      <dd>The namelist scheme. Refer to <code>namelist:NAME</code> sections in
      the configuration file.</dd>

      <dt><code>svn</code></dt>

      <dd>The Subversion scheme. The location is a Subversion URL or an FCM
      location keyword. A URI with these schemes <var>svn</var>,
      <var>svn+ssh</var> and <var>fcm</var> are automatically recognised.</dd>

      <dt><code>rsync</code></dt>

      <dd>This scheme is useful for pulling a file or directory from a remote
      host using <code>rsync</code> via <code>ssh</code>. A URI should have the
      form <var>[USER@]HOST:PATH</var>.</dd>
    </dl>

    <p>The application launcher will use the following logic to determine the
    root directory to install file targets with a relative path:</p>

    <ol>
      <li>If the setting <var>file-install-root=PATH</var> is specified (at the
      root level) in the application configuration file, its value will be
      used.</li>

      <li>If the environment variable <var>ROSE_FILE_INSTALL_ROOT</var> is
      specified, its value will be used.</li>

      <li>Otherwise, the working directory of the task will be used.</li>
    </ol>

    <h2 id="appendix-rose-ana-config">Appendix: rose-ana configuration
    format</h2>

    <p>The <code>rose-ana</code> builtin application reads information about
    which comparisons to perform from the <code>rose-app.conf</code> file for
    that task. The first element is a human-readable name in square brackets,
    followed by the following settings, one per line:</p>

    <ul>
      <li>comparison - The class name which will be called to compare the
      resulting data from the extract command.</li>

      <li>extract - Either the class name which should be called to extract
      data from the files to be compared, or a system command which will be
      called to extract or compare the files. In the latter case, the tokens
      <var>{resultfile}</var> and <var>{kgo1file}</var> map to the values
      defined in the configuration file. The token <var>{file}</var> will
      result in the command being called twice, once on <var>{resultfile}</var>
      and once on <var>{kgo1file}</var>. Some extraction classes such as
      <kbd>OutputGrepper</kbd> require additional information about how to
      extract the data, such as a pattern to match. This should be placed after
      the class name, separated from it by a colon.</li>

      <li>kgo1file - The path and name of the file containing the known good
      output. Environment variables and the wildcard character <var>*</var> are
      accepted. <var>{}</var> is expanded with arguments passed to the
      application.</li>

      <li>resultfile - The path and name of the file containing the output to
      be compared. Environment variables and the wildcard character
      <kbd>*</kbd> are accepted. <var>{}</var> is expanded with arguments
      passed to the application.</li>

      <li>tolerance - For inexact comparisons such as <kbd>Within</kbd>, the
      tolerance should be specified using this variable. Values with a
      percentage sign are treated as percentages, otherwise values are treated
      as a range either side of the known good output value. This value is
      optional; some comparisons such as <kbd>Exact</kbd> do not require
      it.</li>

      <li>warnonfail - If this is set to be <kbd>yes</kbd> a failure of the
      test will result in a warning rather than a failure. This value is always
      optional.</li>
    </ul>

    <p>For example:</p>
    <pre class="prettyprint lang-rose_conf">
[Compare initial norms]
resultfile=$OUTPUT_DIR/fort6.pe0
kgo1file=/path/to/kgo/fort6.pe0
extract=OutputGrepper:um_initial_norms
comparison=Within
tolerance=5%
</pre>
    <pre class="prettyprint lang-rose_conf">
[Compare Gradiant]
comparison=Exact
extract=OutputGrepper:' gradJ= \s*(\S+)'
kgo1file=$SUITE_CONTROL_DIR/log/job/{}.1.1.out
resultfile=$ROSE_SUITE_DIR/log/job/{}.1.1.out
</pre>
  </div>
</body>
</html>
