<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Rose User Guide: Configuration Metadata Development</title>
  <meta name="author" content="Rose Team, Met Office, UK" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="defaultView" content="outline" />
  <meta name="controlVis" content="visible" />
  <link rel="stylesheet" href="S5/slides.css" type="text/css" media=
  "projection" id="slideProj" />
  <link rel="stylesheet" href="S5/outline-rose.css" type="text/css" media=
  "screen" id="outlineStyle" />
  <link rel="stylesheet" href="S5/opera.css" type="text/css" media="projection"
  id="operaFix" />
  <link rel="icon" href="rose-icon.png" type="image/png" />
  <link rel="shortcut icon" href="rose-icon.png" type="image/png" />
  <script src="S5/slides.js" type="text/javascript">
</script>
  <script type="text/javascript" src="jquery.min.js">
</script>
  <script type="text/javascript" src="rose-doc.js">
</script>
  <script type="text/javascript" src="rose-version.js">
</script>
</head>

<body>
  <div id="body-header">
    <address>
      &copy; British Crown Copyright 2012
      <a href="http://www.metoffice.gov.uk">Met Office</a>.
      See <a href="rose-terms-of-use.html">Terms of Use</a>.
      <br />
      This document is released under the <a href=
      "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
      "license">Open Government Licence</a>.
      <span id="rose-version"></span>
    </address><img id="rose-icon" src="rose-icon.png" alt="Rose" />

    <p><a id="doc-home-link" href="." name="doc-home-link">Rose
    Documentation</a></p>

    <div class="layout">
      <div id="currentSlide">
        <!-- DO NOT EDIT -->
      </div>

      <div id="controls">
        <!-- DO NOT EDIT -->
      </div>
    </div>

    <div id="footer"></div>
  </div>

  <div id="content"></div>

  <div id="body-main" class="presentation">
    <div class="slide">
      <h1>Rose User Guide: Configuration Metadata Development</h1>
    </div>

    <div class="slide">
    <h2 id="intro">Introduction</h2>

    <p>Configuration Metadata is used to provide information about settings in
    Rose configurations. It is intended to:</p>
    <ul class="incremental">
      <li>help document your inputs</li>
      <li>perform automatic checking (including whether an input is needed)</li>
      <li>enhance the interface to your configurations in e.g. the Rose config editor</li>
    </ul>

    </div>

    <div class="slide">
    <h3 style="display:none">Introduction: reference</h3>
    <p>For reference and a fuller picture of Rose configuration metadata,
    please refer to the <a href="rose-configuration.html#meta">Rose Reference
    Guide: Configuration Metadata</a>.</p>
    </div>

    <div class="slide">
    <h2 id="example">Example</h2>

    <p>This example uses the Rose example suite from the <a href=
    "rose-brief-tour.html">brief tour</a> and assumes that you are familiar
    with it and have it to hand. Otherwise, go back to the brief tour and
    follow the instructions to check it out or recreate it.</p>

    <p>We are going to develop metadata for the app <code>my_hello_mars</code>.
    Change directory to the suite directory, then change directory to
    <code>app/my_hello_mars</code>.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: text editor</h3>
    <p>Open the Rose application file (<code>rose-app.conf</code>) in this
    directory. It should look like this:</p>
    <pre>
[command]
default = hello.exe

[env]
MAX_TARGETS = 5
LANG_JUPITER = Europan
WORLD = Mars

</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: config editor</h3>   
    <p>Open this application directory in the Rose config editor by typing:</p>
    <pre class="shell">
rose edit
</pre>

    <p>Look at the page <code>env</code>. The three options
    <var>LANG_JUPITER</var>, <var>MAX_TARGETS</var>, <var>WORLD</var> appear in
    raw form - there are no special widgets for the number in
    <var>MAX_TARGETS</var> and no hover-over descriptions of the variables or
    help. We actually haven't added any value over the raw text. Let's close
    the config editor for now.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata</h3>   
    <p>Let's create a metadata directory and start adding some information.</p>

    <p>If we were in a hurry, we could use the
    <a href="rose-command.html#rose-metadata-gen">rose metadata-gen</a>
    command which will populate a metadata configuration based on an
    application or suite configuration. It can make educated guesses about
    variable types as well (option <code>--auto-type</code>). This provides a
    base for further development, and saves a lot of typing. We'll ignore it
    for the purposes of this guide.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata directory</h3>   
    <p>Create the sub directory <code>meta</code> in your application
    directory:</p>
    <pre class="shell">
mkdir meta
</pre>

    <p>This is where Rose will look for our metadata by default. We'll add a
    metadata file by running:</p>
    <pre class="shell">
touch meta/rose-meta.conf
</pre>

    <p>This is where the main metadata configuration lives. Open the file in a
    text editor.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata setting</h3>   
    <p>Let's provide some type information about <var>MAX_TARGETS</var>. The id
    for this variable is <var>env=MAX_TARGETS</var>, so add a section into the
    file.:</p>
    <pre>
[env=MAX_TARGETS]
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata type</h3>   
    <p>We can specify that it's an integer by giving it a type:</p>
    <pre>
[env=MAX_TARGETS]
type = integer
</pre>
    </div>
    
    <div class="slide">
    <h3 style="display:none">Example: metadata title</h3>   
    <p>We could also improve the way it's displayed by giving it a title:</p>
    <pre>
[env=MAX_TARGETS]
title = Max target number
type = integer
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>   
    <p>Now if we save the file and open the application in the config editor
    again, we see that the value of <var>MAX_TARGETS</var> now appears in a
    special numeric widget, and that the title has replaced the name. You can
    see the difference easily by switching metadata off and on (toggle
    menu <kbd>Metadata -&gt; Switch off Metadata</kbd>).</p>
 
    <p>Setting the type does more than change the widget - it also instructs
    Rose to check that the input is valid for that type. If the value of
    <var>MAX_TARGETS</var> was <samp>5.6</samp> or <samp>banana</samp>,
    (anything non-integer) an error would be flagged.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata range</h3>   
    <p>We've set the type of <var>MAX_TARGETS</var> to <samp>integer</samp>,
    but we haven't ruled out choices of integer that would crash our code, such
    as negative integers. We need to restrict the number using a range. To do
    this add a range as follows:</p>
    <pre>
[env=MAX_TARGETS]
range = 0:
title = Max target number
type = integer
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>  
    <p>This means that any integer less than zero will be flagged as a problem.
    With the Metadata switched on, try decreasing the value of
    <var>MAX_TARGETS</var> below 0. An error will be flagged next to the
    variable and on the page list in the left hand panel. If you change it to
    an integer value of 0 or greater, the error will go away.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata description</h3>  
    <p>Let's now make the <var>WORLD</var> setting less ambiguous. Create a section in
    the metadata</p>
    <pre>
[env=WORLD]
</pre>

    <p>Add a title and description:</p>
    <pre>
[env=WORLD]
description = Choose your target world to say hello to.
title = World
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>  
    <p>If you close and open the config editor again, (or switch the metadata
    off and on), you'll see that <var>WORLD</var> now has some helpful
    hover-over text when you move the mouse over the title.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata pattern</h3>  
    <p>We'll decide to be harsh about grammar and insist that the first letter
    of <var>WORLD</var> must be capitalised. To do this, we can use a very simple
    regular expression by adding a pattern:</p>
    <pre>
[env=WORLD]
description = Choose your target world to say hello to.
pattern = ^[A-Z]
title = World
</pre>
    </div>
    
    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>
    <p>Reload the config editor (metadata off/on or close and reopen) and change the first letter of the value of <var>WORLD</var> to
    lowercase.</p>
    
    <p>You've now caused an error! The menu button next to the
    <samp>World</samp> label will change colour and have hover-over text describing the error. There should be some error icons in the page list
    as well.</p>

    <p>You can change the value back to fix it.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata values</h3>  
    <p>Alternatively, we could just give a list of valid world names - this
    means we won't need a regular expression or any other type information.
    Let's remove the pattern and add a list of values:</p>
    <pre>
[env=WORLD]
description = Choose your target world to say hello to.
title = World
values = Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, Neptune
</pre>

    <p>(You may add or remove <samp>Pluto</samp> in line with your personal
    preferences.)</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>  
    <p>Now when you open the application in the config editor, you'll get a
    drop-down list of worlds to choose from. Isn't that nice! Rose will now
    check <var>WORLD</var> in the future to make sure its value is in this
    list.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata trigger</h3>  
    <p>Looking at the other variable in the configuration, it doesn't appear as
    if we really need a Jupiter language <var>LANG_JUPITER</var> set when
    <var>WORLD</var> is not <samp>Jupiter</samp>. Let's add a trigger to
    automatically handle this:</p>
    <pre>
[env=WORLD]
description = Choose your target world to say hello to.
title = World
trigger = env=LANG_JUPITER: Jupiter
values = Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, Neptune

[env=LANG_JUPITER]
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata trigger explanation</h3>  
    <p>This means that <var>LANG_JUPITER</var> will be <em>ignored</em> when
    <var>WORLD</var> is not <samp>Jupiter</samp> - but it will be
    <em>enabled</em> when it is. Ignored variables won't get passed into our
    <var>hello.exe</var> application.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata trigger explanation</h3>
    <p>Set <var>WORLD</var> to <samp>Jupiter</samp>. Next, either save and
    reopen the config editor, or just switch metadata off and on.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>  
    <p>Now when you change the value of <var>WORLD</var> to
    <samp>Saturn</samp>, or any other planet, <var>LANG_JUPITER</var> will be
    <em>ignored</em> and hidden by default in the config editor (you can show
    it by selecting <kbd>View -&gt; View All Ignored Variables</kbd>). If you
    change it back to <samp>Jupiter</samp>, it will be <em>enabled</em> and
    re-appear.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: add more metadata</h3>  
    <p>When you're done, change <var>WORLD</var> to <samp>Earth</samp> and
    save.</p>

    <p>You can experiment with adding metadata to <var>LANG_JUPITER</var> if
    you wish.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata memories</h3>  
    <p>An important advantage of adding metadata is that it acts as a memory of
    inputs. If you remove <var>WORLD</var> (in a text editor or using the
    little button next to the title in the config editor) and save, any
    information about the variable <var>WORLD</var> is lost from your physical
    copy of the application. Close the config editor and check the application
    file.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata ghosts</h3>
    <p>If you then re-open the <var>WORLD</var>-less application in the config
    editor, you can navigate to the <code>env</code> page and see that it's
    missing.</p>

    <p>If you select the menu option <kbd>View -&gt; View Latent Variables</kbd>, any
    variables that are in the metadata but aren't in the application will be
    displayed - <var>WORLD</var> will reappear as a ghost! You can add the
    variable back into the application by clicking on the button next to the
    name and selecting <samp>Add</samp>. It will be added with a 'best guess'
    value based on the metadata, which in this case will be
    <samp>Mercury</samp>.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata help</h3>
    <p>Let's add some proper help for <var>LANG_JUPITER</var> - Jovian
    linguistics are notoriously difficult. Add:</p>
    <pre>
[env=LANG_JUPITER]
help = This variable controls which language to use when saying hello
     = to Jupiter.
     =
     = The Galilean moons of Jupiter are Io, Europa, Ganymede and Callisto.
     =
     = The Great Red Spot people are not worth it.
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>
    <p>If you open the application in the config editor, or switch metadata off
    and on, you can now click on the title of <var>LANG_JUPITER</var> or use
    the menu button to launch a help dialog.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata for sections</h3>
    <p>Let's improve the look of the <code>page</code> by adding metadata for
    the section:</p>
    <pre>
[env]
description = Hello Environment
help = These environment variables provide overrides for the hello.f90 program.
     =
     = Use these to say hello to other planets.
title = Environment
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>
    <p>On reload of the config editor, this gives a hover-over text
    (description) when the mouse is over the page name, and a menu option for
    help for this section (right click on the page name).</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata namespace</h3>

    <p>We can also swap variables in and out of pages, regardless of whether
    they belong in the <code>env</code> application section or not. Let's move
    <var>LANG_JUPITER</var>. Add a namespace (<var>ns</var>):</p>
    <pre>
[env=LANG_JUPITER]
help = This variable controls which language to use when saying hello
     = to Jupiter.
     =
     = The Galilean moons of Jupiter are Io, Europa, Ganymede and Callisto.
     =
     = The Great Red Spot people are not worth it.
ns = languages
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>
    <p>A reload of the config editor will show that <var>LANG_JUPITER</var> has
    been moved to a different page called languages. This can be useful for
    moving environment variables to their relevant namelists, or breaking up
    large namelists into several sections.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: metadata url</h3>

    <p>Sometimes just having help or descriptions isn't enough, or there's a
    more relevant resource page on the Web - in this case you can add a url
    help:</p>
    <pre>
[env=LANG_JUPITER]
help = This variable controls which language to use when saying hello
     = to Jupiter.
     =
     = The Galilean moons of Jupiter are Io, Europa, Ganymede and Callisto.
     =
     = The Great Red Spot people are not worth it.
ns = languages
url = http://solarsystem.nasa.gov/planets/profile.cfm?Object=Jupiter
</pre>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: view changes</h3>
    <p>This can be accessed via the variable button menu (<var>Web Help</var>)
    in the config editor on reload, or via clicking on the variable name when
    there's no help.</p>
    </div>

    <div class="slide">
    <h3 style="display:none">Example: reference</h3>

    <p>We've finished! However, there are other things you can do with
    configuration metadata. Make sure you have a good idea of when to use these
    by consulting the <a href="rose-configuration.html#meta">Rose Reference
    Guide &gt; Configuration Metadata</a>.</p>
    </div>

    <div class="slide">
    <h2 id="upgrade">Upgrade Macro Development</h2>

    <p>Upgrade macros automate the process of updating configurations from one
    version to the next, such as removing redundant settings or adding new
    ones.</p>
    </div>
  </div>
</body>
</html>
