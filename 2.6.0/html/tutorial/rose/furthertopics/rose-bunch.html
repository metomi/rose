



<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rose Bunch &mdash; Rose Documentation 2.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=47202671" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/diff_selector.css?v=9704a72b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/grid_table.css?v=0285b42e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/hieroglyph_theme_addons.css?v=814c2015" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/tutorial.css?v=b869d33c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/addons.css?v=d1f804c3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=466af0f7" />

  
    <link rel="shortcut icon" href="../../../_static/rose-favicon.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=ae39cb24"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=7c20c939"></script>
      <script src="../../../_static/js/diff_selector.js?v=3109bfa4"></script>
      <script src="../../../_static/js/minicylc.js?v=ddc882fd"></script>
      <script src="../../../_static/js/spoiler.js?v=12631137"></script>
      <script src="../../../_static/js/addons.js?v=39bd7dee"></script>
      <script src="../../../_static/js/versioning.js?v=df0214e8"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Rose Stem" href="rose-stem.html" />
    <link rel="prev" title="Rose Arch" href="rose-arch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/rose-logo-crop.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Rose Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configurations.html">Rose Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applications.html">Rose Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata.html">Rose Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../suites.html">Rose Suite Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../summary.html">Summary</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Further Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="command-keys.html">Command Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="date-time-manipulation.html">Date and Time Manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="failif-warnif.html">Fail-If, Warn-If</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro-development.html">Custom Macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="optional-configurations.html">Optional Configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="polling.html">Polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="rose-arch.html">Rose Arch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Rose Bunch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#naming-invocations">Naming Invocations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limiting-concurrent-invocations">Limiting Concurrent Invocations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rose-stem.html">Rose Stem</a></li>
<li class="toctree-l3"><a class="reference internal" href="rose-stem-tutorial.html">Rose Stem Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="rosie.html">Rosie</a></li>
<li class="toctree-l3"><a class="reference internal" href="trigger.html">Trigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrading.html">Upgrading</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrading-macro-development.html">Upgrading Macro Development</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Rose API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/configuration/index.html">Rose Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/command-reference.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/environment-variables.html">Rose Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/other.html">Other Python API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-bash-library.html">Rose Bash Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-built-in-applications.html">Rose Built-In Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-macro.html">Rose Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-upgrader-macros.html">Rose Upgrade Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rosie-web.html">Rosie Web API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../terms.html">Rose Terms Of Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../course/um-ut.html">UM User Tutorial</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Rose Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Rose Tutorial</a></li>
          <li class="breadcrumb-item"><a href="index.html">Further Topics</a></li>
      <li class="breadcrumb-item active">Rose Bunch</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/metomi/rose/blob/master/sphinx/tutorial/rose/furthertopics/rose-bunch.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rose-bunch">
<h1>Rose Bunch<a class="headerlink" href="#rose-bunch" title="Link to this heading"></a></h1>
<p><a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> is a built-in <a class="reference internal" href="../../../glossary.html#term-Rose-app"><span class="xref std std-term">Rose app</span></a> which allows multiple
variants of a command to be run under a single job.</p>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading"></a></h2>
<p>Often, we want to run many instances of a command that differ only slightly
from each other at the same time - an example would be where a command is
run repeatedly with only its arguments changing.</p>
<p>Rather than creating multiple apps or
<a class="reference internal" href="optional-configurations.html#rose-tutorial-optional-configurations"><span class="std std-ref">optional configs</span></a> to change
the way a command is to be run, we can instead use the built-in
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> application to run multiple command variants, in
parallel, under a single job as defined by an application configuration.</p>
<p>Note, however, that for “embarrassingly parallel” code it would be better to
alter the code rather than use <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> to handle this for you.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is important to note that when running your <code class="docutils literal notranslate"><span class="pre">rose_bunch</span></code>
<a class="reference internal" href="../../../glossary.html#term-Rose-app"><span class="xref std std-term">app</span></a> under load balancing systems such as PBS or Slurm,
you will need to set resource requests to reflect the resources required
by running multiple commands at once.</p>
<p>For example, if a single command would require 1GB memory and the app is
configured to run up to 4 commands at once then 4GB of memory should be
requested.</p>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p>In this example we are going to create a suite that simulates the handling of
landing planes at an airport. For a given plane the process of landing and
unloading is the same: land, taxi to the terminal, unload passengers and get
clear. We can refer to this as the “landing” routine. What differs between
landings is the plane type, number of passengers carried and the resulting
timings for each stage of the landing process.</p>
<p>Create a new Rose suite configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Create a blank <a class="reference internal" href="../../../api/configuration/suite.html#rose:file:rose-suite.conf" title="rose:file:rose-suite.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-suite.conf</span></code></a> and a <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code>
file that looks like this:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[scheduling]</span>
    <span class="nt">[[graph]]</span>
        <span class="nv">R1 </span><span class="o">=</span> <span class="kd">lander</span>
<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> rose task-run</span>
    <span class="nt">[[lander]]</span>
</pre></div>
</div>
<p>In the source directory create an <code class="docutils literal notranslate"><span class="pre">app/</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">app</span>
</pre></div>
</div>
<p>In the app directory create a <code class="docutils literal notranslate"><span class="pre">lander/</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">app</span>
<span class="n">mkdir</span> <span class="n">lander</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">app/lander/</span></code> directory create a <a class="reference internal" href="../../../api/configuration/application.html#rose:file:rose-app.conf" title="rose:file:rose-app.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-app.conf</span></code></a> file
using your editor of choice and paste the following lines into it:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">mode</span><span class="o">=</span><span class="s">rose_bunch</span>

<span class="nt">[bunch]</span>
<span class="nv">command-format</span><span class="o">=</span><span class="s">land %(class)s %(passengers)s</span>

<span class="nt">[bunch-args]</span>
<span class="nv">class</span><span class="o">=</span><span class="s">airbus concorde airbus cessna</span>
<span class="nv">passengers</span><span class="o">=</span><span class="s">40 20 30 2</span>
</pre></div>
</div>
<p>This configuration will run a <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> task that calls multiple
instances of the <code class="docutils literal notranslate"><span class="pre">land</span></code> command, supplying arguments to each instance
from the <code class="docutils literal notranslate"><span class="pre">class</span></code> and <code class="docutils literal notranslate"><span class="pre">passengers</span></code> entries under
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch-args]" title="rose:conf:rose_bunch[bunch-args]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch-args]</span></code></a>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">app/lander/</span></code> directory create a <code class="docutils literal notranslate"><span class="pre">bin/</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="nb">bin</span>
</pre></div>
</div>
<p>Using your editor of choice, create a file named <code class="docutils literal notranslate"><span class="pre">land</span></code> under the <code class="docutils literal notranslate"><span class="pre">bin</span></code>
directory and paste in these lines:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">CLASS</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">PASSENGERS</span><span class="o">=</span><span class="nv">$2</span>

<span class="c1"># Get settings</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$CLASS</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>airbus<span class="o">)</span><span class="w"> </span><span class="nv">LANDTIME</span><span class="o">=</span><span class="m">30</span><span class="p">;</span><span class="w"> </span><span class="nv">UNLOADRATE</span><span class="o">=</span><span class="m">8</span><span class="p">;;</span>
<span class="w">    </span>cessna<span class="o">)</span><span class="w"> </span><span class="nv">LANDTIME</span><span class="o">=</span><span class="m">20</span><span class="p">;</span><span class="w"> </span><span class="nv">UNLOADRATE</span><span class="o">=</span><span class="m">2</span><span class="p">;;</span>
<span class="w">    </span>concorde<span class="o">)</span><span class="w"> </span><span class="nv">LANDTIME</span><span class="o">=</span><span class="m">10</span><span class="p">;</span><span class="w"> </span><span class="nv">UNLOADRATE</span><span class="o">=</span><span class="m">4</span><span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[ </span><span class="k">$(</span>rose<span class="w"> </span>date<span class="k">)</span><span class="s2"> ] </span><span class="nv">$CLASS</span><span class="s2"> carrying </span><span class="nv">$PASSENGERS</span><span class="s2"> passengers incoming&quot;</span>

<span class="c1"># Land plane</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[ </span><span class="k">$(</span>rose<span class="w"> </span>date<span class="k">)</span><span class="s2"> ] Approaching runway&quot;</span>
sleep<span class="w"> </span><span class="nv">$LANDTIME</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[ </span><span class="k">$(</span>rose<span class="w"> </span>date<span class="k">)</span><span class="s2"> ] On the tarmac&quot;</span>

<span class="c1"># Unload passengers</span>
sleep<span class="w"> </span><span class="k">$((</span><span class="nv">$PASSENGERS</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">$UNLOADRATE</span><span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[ </span><span class="k">$(</span>rose<span class="w"> </span>date<span class="k">)</span><span class="s2"> ] Unloaded&quot;</span>

<span class="c1"># Clear terminal</span>
sleep<span class="w"> </span><span class="m">10</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[ </span><span class="k">$(</span>rose<span class="w"> </span>date<span class="k">)</span><span class="s2"> ] Clear of terminal&quot;</span>
</pre></div>
</div>
<p>This script captures the landing routine and expects two arguments: the plane
type (its class) and the number of passengers it is carrying.</p>
<p>Finally, make the new <code class="docutils literal notranslate"><span class="pre">land</span></code> file executable by navigating into the <code class="docutils literal notranslate"><span class="pre">bin</span></code>
directory of the lander app and running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">land</span>
</pre></div>
</div>
<p>Navigate to the top directory of your source workflow (where the <code class="docutils literal notranslate"><span class="pre">flow.cylc</span></code> and
<a class="reference internal" href="../../../api/configuration/suite.html#rose:file:rose-suite.conf" title="rose:file:rose-suite.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-suite.conf</span></code></a> files can be found) and validate, install and run
the workflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">validate</span> <span class="o">.</span>
<span class="n">cylc</span> <span class="n">install</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Once the workflow has finished running and has shutdown, open Cylc Review to view
its output (note that you can close the Cylc GUI at this point):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">review</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can quickly view the workflow log by running
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">cat-log</span> <span class="pre">rose-bunch</span></code> .</p>
</div>
<p>In the Cylc Review jobs page for your workflow you should be presented with a
page containing a single row for the <code class="docutils literal notranslate"><span class="pre">lander</span></code> task, from which you can
access its output. In that row you should see something like this:</p>
<img alt="Cylc Review view of output" class="align-center" src="../../../_images/rose-bunch-bush-page.png" />
<p>In the Cylc Review entry you should see that the usual links are present for
the task such as <code class="docutils literal notranslate"><span class="pre">job.out</span></code>, <code class="docutils literal notranslate"><span class="pre">job.status</span></code> etc. with the addition of
two drop-down boxes: one for <code class="docutils literal notranslate"><span class="pre">bunch.*.err</span></code> and one for <code class="docutils literal notranslate"><span class="pre">bunch.*.out</span></code>.
Rather than mixing the outputs from the multiple command invocations being
run at once, <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> directs their output to individual output
files. So, for example, the output from running the command with the first set
of parameters can be found in the <code class="docutils literal notranslate"><span class="pre">bunch.0.out</span></code> file, the second set in the
<code class="docutils literal notranslate"><span class="pre">bunch.1.out</span></code> file etc. Examine these output files now to confirm that all
four of the args combinations have been run and produced output.</p>
</section>
<section id="naming-invocations">
<h2>Naming Invocations<a class="headerlink" href="#naming-invocations" title="Link to this heading"></a></h2>
<p>While the different invocations of the command have their own output directed
to indexed files, it can sometimes be difficult to quickly identify which file
to look in for output. To aid this, <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> supports naming
command instances via the <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]names" title="rose:conf:rose_bunch[bunch]names"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]names=</span></code></a> option.</p>
<p>Returning to our source directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Open your app config (under <code class="docutils literal notranslate"><span class="pre">app/lander/rose-app.conf</span></code>) and add the
following line under the <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]" title="rose:conf:rose_bunch[bunch]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]</span></code></a> section:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">names</span><span class="o">=</span><span class="s">BA123 Emirates345 BA007 PC456</span>
</pre></div>
</div>
<p>We can now install and play this updated suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">validate</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
<span class="n">cylc</span> <span class="n">install</span> <span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Inspecting the job log directory for this latest run on Cylc Review, the
<code class="docutils literal notranslate"><span class="pre">bunch.*.err</span></code> and <code class="docutils literal notranslate"><span class="pre">bunch.*.out</span></code> files now have the names you have
configured rather than the previous <code class="docutils literal notranslate"><span class="pre">bunch.0.out</span> <span class="pre">...</span> <span class="pre">bunch.3.out</span></code>.</p>
</section>
<section id="limiting-concurrent-invocations">
<h2>Limiting Concurrent Invocations<a class="headerlink" href="#limiting-concurrent-invocations" title="Link to this heading"></a></h2>
<p>In some situations we may need to limit the number of concurrently running
command invocations - often as a result of resource limitations. Rather than
batching up jobs into sets of <em>N</em> simultaneously running commands,
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a>
apps can be configured to run as many commands as possible within some limit
i.e. while <em>N</em> commands are running, if one of them finishes, don’t wait for the
remaining <em>N</em>-1 jobs to finish before running the (<em>N</em>+1)th one.</p>
<p>In the case of our simulated airport we will pretend we only have two runways
available at a time on which our planes can land. As such we need to limit the
number of planes landing. We do this using the
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]pool-size" title="rose:conf:rose_bunch[bunch]pool-size"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]pool-size=</span></code></a> configuration option of the
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Open your app config (under <code class="docutils literal notranslate"><span class="pre">app/lander/rose-app.conf</span></code>) and add the
following line to the <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]" title="rose:conf:rose_bunch[bunch]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]</span></code></a> section:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">pool-size</span><span class="o">=</span><span class="s">2</span>
</pre></div>
</div>
<p>We can now install and play this updated suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">validate</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
<span class="n">cylc</span> <span class="n">install</span> <span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="n">rose</span><span class="o">-</span><span class="n">bunch</span>
</pre></div>
</div>
<p>Notice that this time round it takes longer for the task to run as it has been
limited in the number of command variants it can run simultaneously.</p>
<p>As an example, when the <code class="docutils literal notranslate"><span class="pre">BA007</span></code> invocation starts running you should see
the line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[INFO] BA007: added to pool
</pre></div>
</div>
<p>appear in the job output after a while whereas, when running without a
<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]pool-size" title="rose:conf:rose_bunch[bunch]pool-size"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]pool-size</span></code></a>, the line will appear pretty quickly.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>In this tutorial we have learnt how to configure a <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> app
to run a set of command variants under one job. We have learnt how to name the
individual variants for convenience in examining the logs and how to limit
the number of concurrently running commands.</p>
<p>Further options are listed in the <a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:app:rose_bunch" title="rose:app:rose_bunch"><code class="xref rose rose-app docutils literal notranslate"><span class="pre">rose_bunch</span></code></a> documentation. These
include configuring how to proceed following failure of an individual command
invocation (<a class="reference internal" href="../../../api/built-in/rose_bunch.html#rose:conf:rose_bunch[bunch]fail-mode" title="rose:conf:rose_bunch[bunch]fail-mode"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]fail-mode=</span></code></a>), automatically
generating <em>N</em> command instances and enabling/disabling the app’s incremental
mode.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rose-arch.html" class="btn btn-neutral float-left" title="Rose Arch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rose-stem.html" class="btn btn-neutral float-right" title="Rose Stem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright : Copyright (C) British Crown (Met Office) &amp; Contributors. See Terms of Use. This document is released under the Open Government Licence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Read the Docs</span>
    v: 2.6.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions" id="version-selector">
    <script type="text/javascript">
        // NOTE: temporary variables not initiated so that they can be deleted

        // path to a root file in the current version of the documentation
        version_path = "../../../.html".split('/');
        // dirname of the root dir
        version_dir = version_path
            .splice(0, version_path.length - 1)
            .join('/');
        delete version_path;
        // relative path from the current version to the documentation root
        rel_path = '../../';
        // relative path from the current document to the documentation root
        var root_dir;
        if (version_dir) {
            root_dir = version_dir + '/' + rel_path;
        } else {
            root_dir = rel_path;
        }
        delete version_dir;
        delete rel_path;
        // the name of the current version of the documentation
        const current_version = "2.6.0";
        // the name of the builder (i.e. html)
        const current_builder = "html";
        // the name of the current page
        const current_page_name = "tutorial/rose/furthertopics/rose-bunch";
    </script>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
<style>
/* make sidebar header off-white. NB: only very light colours work given image
   edge transparency issues, but white itself clashes with the main pages.  */
.wy-side-nav-search, .wy-nav-top {
    background: #f9f9eb;
}
/* make sidebar header version text the dark blue of the Rose logo */
.wy-side-nav-search div.version {
    color: #2B2663;
}
</style>


</body>
</html>