#!/usr/bin/env bash
#-------------------------------------------------------------------------------
# (C) British Crown Copyright 2012 Met Office.
# 
# This file is part of Rose, a framework for scientific suites.
# 
# Rose is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# Rose is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with Rose. If not, see <http://www.gnu.org/licenses/>.
#-------------------------------------------------------------------------------
# NAME
#     rose stem
#
# SYNOPSIS
#     rose stem [options]
#
# DESCRIPTION
#     Run a suitable suite with a specified set of source tree(s). 
#
#     Default values of some of these settings are suite-dependent, specified 
#     in the rose-suite.conf file.
#
# EXAMPLES
#     rose stem --diffsource=$PWD
#     rose stem --source=fcm:source_tr@head --task=myjob
#     rose stem --source=fcm:source_tr@head --source=fcm:othersrc_tr@head 
#     rose stem --diffsource=. --confsource=fcm:source_tr@head --task=all
#     rose stem --source=$PWD -C ~/roses/mot-aa121 --task=myjob --task=yourjob
#
# OPTIONS
#     All options of "rose suite-run" are supported. Additional options are:
#
#     --confsource=DIR, -c DIR
#         Specify an alterate top-level source tree directory. 
#         This may be used to locate 'fcm make' config files. If not set, this
#         defaults to the first --diffsource set on the command line, or 
#         the first --source if --diffsource is not specified. This controls
#         the variables URL_CONFDIR and URL_CONFREV, which are the path and 
#         revision of the source to take the config file from respectively.
#     --diffsource=SOURCE, -d SOURCE
#         Specify a source tree to add to the trunk as a branch. This sets the
#         variable URL_<project>_DIFF. Multiple branches can be added by
#         successive uses of this option.
#     --source=SOURCE, -s SOURCE
#         Specify a source tree to run as the trunk. This sets the variable
#         URL_<project>. Trunks for different projects can be set by using
#         multiple --source arguments.
#     --task=TASK, -t TASK
#         Specify a task name or group to run. This sets the variable RUN_NAMES
#         which is a Python list of jobs (or groups of jobs) to run.
#
# PROJECT NAME RULES
#
#     The project name is derived from the output of the 'fcm loc-layout' 
#     command. The target is taken from the output, and the first two elements 
#     after the machine name are taken as the project with the following rules:
#         * If the first element ends in _svn, this is stripped off
#         * If the two elements are identical, ignore the second element
#         * If only one element is present, use only that.
#         * Project names are always converted to uppercase.
#     Running with increased verbosity (-v) will report the variables which are
#     being set by rose stem.
#
#-------------------------------------------------------------------------------
exec python -m rose.stem "$@"
