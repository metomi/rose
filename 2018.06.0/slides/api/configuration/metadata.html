

<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration Metadata &mdash; Rose Documentation 2018.06.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/css/slides-custom.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../../_static/css/metomi.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2018.06.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
    <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/metomi.js"></script>
    <script type="text/javascript" src="../../_static/js/versioning.js"></script>
    <script type="text/javascript" src="../../_static/common.js"></script>
    
    <script type="text/javascript" src="../../_static/slides.js"></script>
    <script type="text/javascript" src="../../_static/sync.js"></script>
    <script type="text/javascript" src="../../_static/controller.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>
    
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Rose Documentation 2018.06.0 documentation" href="../../index.html" />
    <link rel="up" title="Rose Configuration" href="index.html" />
    <link rel="next" title="Rose Configuration Format" href="rose-configuration-format.html" />
    <link rel="prev" title="Site And User Configuration" href="site-and-user.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="configuration-metadata">

<h1>Configuration Metadata<a class="headerlink" href="../../../html/api/configuration/metadata.html#configuration-metadata" title="View HTML">§</a></h1>

<p>Configuration metadata uses the standard <a class="reference internal" href="rose-configuration-format.html#rose-configuration-format"><span class="std std-ref">Rose Configuration Format</span></a>.
It is represented in a directory with the following:</p>
<ul class="simple">
<li><a class="reference internal" href="#rose:file:rose-meta.conf" title="rose:file:rose-meta.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-meta.conf</span></code></a>, the main metadata configuration file.</li>
<li><code class="docutils literal notranslate"><span class="pre">opt/</span></code> directory (see <a class="reference internal" href="rose-configuration-format.html#optional-configuration"><span class="std std-ref">Optional Configuration</span></a>).</li>
<li>Other files, e.g.:<ul>
<li><code class="docutils literal notranslate"><span class="pre">lib/python/widget/my_widget.py</span></code> would be the location of a
<a class="reference internal" href="../../tutorial/rose/furthertopics/widget-development.html#widget-dev"><span class="std std-ref">custom widget</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">lib/python/macros/my_macro_validator.py</span></code> would be the location of a
<a class="reference internal" href="../../tutorial/rose/furthertopics/macro-development.html#macro-dev"><span class="std std-ref">custom macro</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">etc/</span></code> would contain any resources for the logics in <code class="docutils literal notranslate"><span class="pre">lib/python/</span></code>,
such as an icon for the custom widget.</li>
</ul>
</li>
</ul>
<p>Rose utilities will search for metadata using the following in order
of precedence:</p>
<ol class="arabic simple">
<li>Configuration metadata embedded in the <code class="docutils literal notranslate"><span class="pre">meta/</span></code> directory of a suite or an
application.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--meta-path=PATH</span></code> option of relevant commands.</li>
<li>The value of the <span class="target" id="index-0"></span><a class="reference internal" href="../environment-variables.html#envvar-ROSE_META_PATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ROSE_META_PATH</span></code></a> environment variable.</li>
<li>The <a class="reference internal" href="site-and-user.html#rose:conf:rose.conf|meta-path" title="rose:conf:rose.conf|meta-path"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose.conf|meta-path</span></code></a> setting (see <a class="reference internal" href="site-and-user.html#site-and-user-configuration"><span class="std std-ref">Site And User Configuration</span></a>).</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">See <a class="reference internal" href="#app-meta-loc"><span class="std std-ref">Appendix: Metadata Location</span></a> for more details.</p>
</div>
<p>The configuration metadata that controls default behaviour will be located in
<code class="docutils literal notranslate"><span class="pre">$ROSE_HOME/etc/rose-meta/</span></code>.</p>




</article>
<article class="slide level-2" id="configuration-metadata-file">

<h2>Configuration Metadata File<a class="headerlink" href="../../../html/api/configuration/metadata.html#configuration-metadata-file" title="View HTML">§</a></h2>

<p>The <a class="reference internal" href="#rose:file:rose-meta.conf" title="rose:file:rose-meta.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-meta.conf</span></code></a> contains a serialised data structure that is an
unordered map (<code class="docutils literal notranslate"><span class="pre">sections=</span></code>) of unordered maps (<code class="docutils literal notranslate"><span class="pre">keys=values</span></code>).</p>
<p>The section name in a configuration metadata file should be a unique ID to
the relevant configuration setting. The syntax of the ID is
<code class="docutils literal notranslate"><span class="pre">SECTION-NAME=OPTION-NAME</span></code> or just <code class="docutils literal notranslate"><span class="pre">SECTION-NAME</span></code>. For example,
<code class="docutils literal notranslate"><span class="pre">env=MY_ENV_NAME</span></code> is the ID of an environment variable called
<code class="docutils literal notranslate"><span class="pre">MY_ENV_NAME</span></code> in an application configuration file;
<code class="docutils literal notranslate"><span class="pre">namelist:something_nl=variable_name1</span></code> is the ID of a
namelist variable called <code class="docutils literal notranslate"><span class="pre">variable_name1</span></code> in a namelist group called
<code class="docutils literal notranslate"><span class="pre">something_nl</span></code> in an application configuration file. If the configuration
metadata applies to a section in a configuration file, the ID is just the
section name.</p>
<p>Where multiple instances of a section are used in a configuration file,
ending in brackets with numbers, the metadata ID should just be based on the
original section name (for example <code class="docutils literal notranslate"><span class="pre">namelist:extract_control(2)</span></code> should be
found in the metadata under <code class="docutils literal notranslate"><span class="pre">namelist:extract_control</span></code>).</p>
<p>Finally, the configuration metadata may group settings in namespaces, which
may in turn have common configuration metadata settings. The ID for a
namespace set in the metadata is <code class="docutils literal notranslate"><span class="pre">ns=NAME</span></code>, e.g.
<code class="docutils literal notranslate"><span class="pre">ns=env/MyFavouriteEnvironmentVars</span></code>.</p>




</article>
<article class="slide level-3" id="metadata-inheritance-import">

<h3>Metadata Inheritance (Import)<a class="headerlink" href="../../../html/api/configuration/metadata.html#metadata-inheritance-import" title="View HTML">§</a></h3>

<p>A root level <code class="docutils literal notranslate"><span class="pre">import=MY_COMMAND1/VERSION1</span> <span class="pre">MY_COMMAND2/VERSION2</span> <span class="pre">...</span></code> setting
in the <a class="reference internal" href="#rose:file:rose-meta.conf" title="rose:file:rose-meta.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-meta.conf</span></code></a> file will tell Rose metadata utilities to
locate the meta keys <code class="docutils literal notranslate"><span class="pre">MY_COMMAND1/VERSION1</span></code>, <code class="docutils literal notranslate"><span class="pre">MY_COMMAND2/VERSION2</span></code> (and
so on) and inherit their configuration and files if found.</p>
<p>For example, you might have a <code class="docutils literal notranslate"><span class="pre">rose-meta</span></code> directory that contains the
following files and directories:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cheese_sandwich/
    vn1.5/
        rose-meta.conf
    vn2.0/
        rose-meta.conf
cheese/
    vn1.0/
        rose-meta.conf
</pre></div>
</div>
<p>and write an app referencing this <code class="docutils literal notranslate"><span class="pre">rose-meta</span></code> directory that looks like
this:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">meta</span><span class="o">=</span><span class="s">cheese_sandwich/vn2.0</span>

<span class="nt">[env]</span>
<span class="nv">CHEESE</span><span class="o">=</span><span class="s">camembert</span>
<span class="nv">SANDWICH_BREAD</span><span class="o">=</span><span class="s">brown</span>
</pre></div>
</div>
<p>This will reference the metadata at <code class="docutils literal notranslate"><span class="pre">rose-meta/cheese_sandwich/vn2.0</span></code>.</p>
<p>Now, we can write the <a class="reference internal" href="#rose:file:rose-meta.conf" title="rose:file:rose-meta.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-meta.conf</span></code></a> file using an import:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">import</span><span class="o">=</span><span class="s">cheese/vn1.0</span>

<span class="nt">[env=SANDWICH_BREAD]</span>
<span class="nv">values</span><span class="o">=</span><span class="s">white,brown,seeded</span>
</pre></div>
</div>
<p>which will inherit metadata from metadata from
<code class="docutils literal notranslate"><span class="pre">rose-meta/cheese/vn1.0/rose-meta.conf</span></code>.</p>




</article>
<article class="slide level-3" id="metadata-options">

<h3>Metadata Options<a class="headerlink" href="../../../html/api/configuration/metadata.html#metadata-options" title="View HTML">§</a></h3>

<p>The metadata options for a configuration fall into four categories:
<a class="reference internal" href="#metadata-sorting"><span class="std std-ref">sorting</span></a>,
<a class="reference internal" href="#metadata-values"><span class="std std-ref">values</span></a>,
<a class="reference internal" href="#metadata-behaviour"><span class="std std-ref">behaviour</span></a> and
<a class="reference internal" href="#metadata-help"><span class="std std-ref">help</span></a> as outlined below.</p>
<dl class="file">
<dt id="rose:file:rose-meta.conf">
<em class="property">Rose Configuration </em><code class="descname">rose-meta.conf</code></dt>
<dd><dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]">
<em class="property">Config </em><code class="descname">[SETTING]</code></dt>
<dd><p>A section containing metadata items relating to a particular setting.</p>
<p><code class="docutils literal notranslate"><span class="pre">SETTING</span></code> should be the full name of a configuration containing the
name of the section and the name of the setting separated by an equals
<code class="docutils literal notranslate"><span class="pre">=</span></code> sign e.g:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">[env=FOO]</span></code> would refer to the environment variable <code class="docutils literal notranslate"><span class="pre">FOO</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[namelist:foo=BAR]</span></code> would refer to <code class="docutils literal notranslate"><span class="pre">BAR</span></code> from the namelist
<code class="docutils literal notranslate"><span class="pre">foo</span></code>.</li>
</ul>
<p class="rubric" id="metadata-sorting">Metadata for Sorting</p>
<p>These configuration metadata are used for grouping and sorting the IDs of
the configurations.</p>
<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]ns">
<em class="property">Config </em><code class="descname">ns</code></dt>
<dd><p>A forward slash <code class="docutils literal notranslate"><span class="pre">/</span></code> delimited hierarchical namespace for the
container of the setting, which overrides the default. The default
namespace for the setting is derived from the first part of the ID -
by splitting up the section name by colons <code class="docutils literal notranslate"><span class="pre">:</span></code> or forward slashes
<code class="docutils literal notranslate"><span class="pre">/</span></code>. For example, a configuration with an ID
<code class="docutils literal notranslate"><span class="pre">namelist:var_minimise=niter_set</span></code> would have the namespace
<code class="docutils literal notranslate"><span class="pre">namelist/var_minimise</span></code>. If a namespace is defined for a section, it
will become the default for all the settings in that section.</p>
<p>The namespace is used by <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> to group
settings, so that they can be placed in different pages. A namespace for
a section will become the default for all the settings in that section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should not assign namespaces to variables in duplicate sections.</p>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]sort-key">
<em class="property">Config </em><code class="descname">sort-key</code></dt>
<dd><p>A character string that can be used as a sort key for ordering an option
within its namespace.</p>
<p>It can also be used to order sections and namespaces.</p>
<p>The <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]sort-key" title="rose:conf:rose-meta.conf[SETTING]sort-key"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">sort-key</span></code></a> is used by <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> to
group settings on a page.
Items with a <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]sort-key" title="rose:conf:rose-meta.conf[SETTING]sort-key"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">sort-key</span></code></a> will be sorted to the top of a
name-space. Items without a <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]sort-key" title="rose:conf:rose-meta.conf[SETTING]sort-key"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">sort-key</span></code></a> will be sorted after,
in ascending order of their IDs.</p>
<p>The sorting procedure in pseudo code is a normal ASCII-like sorting of a
list of <code class="docutils literal notranslate"><span class="pre">setting_sort_key</span> <span class="pre">+</span> <span class="pre">&quot;~&quot;</span> <span class="pre">+</span> <span class="pre">setting_id</span></code> strings. If there is no
<code class="docutils literal notranslate"><span class="pre">setting_sort_key</span></code>, null string will be used.</p>
<p>For example, the following metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=apple]</span>

<span class="nt">[env=banana]</span>

<span class="nt">[env=cherry]</span>
<span class="nv">sort-key</span><span class="o">=</span><span class="s">favourites-01</span>

<span class="nt">[env=melon]</span>
<span class="nv">sort-key</span><span class="o">=</span><span class="s">do-not-like-01</span>

<span class="nt">[env=prune]</span>
<span class="nv">sort-key</span><span class="o">=</span><span class="s">do-not-like-00</span>
</pre></div>
</div>
<p>would produce a sorting order of <code class="docutils literal notranslate"><span class="pre">env=prune</span></code>, <code class="docutils literal notranslate"><span class="pre">env=melon</span></code>,
<code class="docutils literal notranslate"><span class="pre">env=cherry</span></code>, <code class="docutils literal notranslate"><span class="pre">env=apple</span></code>, <code class="docutils literal notranslate"><span class="pre">env=banana</span></code>.</p>
</dd></dl>

<p class="rubric" id="metadata-values">Metadata for Values</p>
<p>These configuration metadata are used to define the valid values of a
setting. A Rose utility such as <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> can use
these metadata to
display the correct widget for a setting and to check its input. However,
if the value of a setting contains a string that looks like an environment
variable, these metadata will normally be ignored.</p>
<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]type">
<em class="property">Config </em><code class="descname">type</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">raw</td>
</tr>
</tbody>
</table>
<p>The type/class of the setting. The type names are based on the
intrinsic Fortran types, such as <code class="docutils literal notranslate"><span class="pre">integer</span></code> and <code class="docutils literal notranslate"><span class="pre">real</span></code>. Currently
supported types are:</p>
<dl class="docutils">
<dt>boolean</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">PRODUCE_THINGS=true</span></code></p>
<p><em>description</em>: either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<p class="last"><em>usage</em>: environment variables, javascript/JSON inputs</p>
</dd>
<dt>character</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">sea_colour='blue'</span></code></p>
<p><em>description</em>: Fortran character type - a single quoted string,
single quotes escaped in pairs</p>
<p class="last"><em>usage</em>: Fortran character types</p>
</dd>
<dt>integer</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">num_lucky=5</span></code></p>
<p><em>description</em>: generic integer type</p>
<p class="last"><em>usage</em>: any integer-type input</p>
</dd>
<dt>logical</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">l_spock=.true.</span></code></p>
<p><em>description</em>: Fortran logical type - either <code class="docutils literal notranslate"><span class="pre">.true.</span></code> or
<code class="docutils literal notranslate"><span class="pre">.false.</span></code></p>
<p class="last"><em>usage</em>: Fortran logical types</p>
</dd>
<dt>python_boolean</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">ENABLE_THINGS=True</span></code></p>
<p><em>description</em>: Python boolean type - either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p class="last"><em>usage</em>: Python boolean types</p>
</dd>
<dt>python_list</dt>
<dd><p class="first"><em>description</em>: used to signify a Python-compatible formatted list
such as <code class="docutils literal notranslate"><span class="pre">[&quot;Foo&quot;,</span> <span class="pre">50,</span> <span class="pre">False]</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This encapsulates <code class="docutils literal notranslate"><span class="pre">length</span></code>, so do not use a
separate <code class="docutils literal notranslate"><span class="pre">length</span></code> declaration for this setting.</p>
</div>
<p class="last"><em>usage</em>: use for inputs that expect a string that looks like a Python
list - e.g. Jinja2 list input variables.</p>
</dd>
<dt>quoted</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">js_measure_cloud_mode=&quot;laser&quot;</span></code></p>
<p><em>description</em>: a double quoted string, double quotes escaped with
backslash</p>
<p class="last"><em>usage</em>: Inputs that require double quotes and allow backslash
escaping e.g. javascript/JSON inputs.</p>
</dd>
<dt>real</dt>
<dd><p class="first"><em>example option</em>: <code class="docutils literal notranslate"><span class="pre">n_avogadro=6.02e23</span></code></p>
<p><em>description</em>: Fortran real number type, generic floating point
numbers</p>
<p><em>usage</em>: Fortran real types, generic floating point numbers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Scientific notation must use the “e” or “E” format.</p>
</div>
<p class="last"><em>comment</em>: Internally implemented within Rose using Python’s
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typesnumeric">floating point</a> specification.</p>
</dd>
<dt>raw</dt>
<dd><p class="first"><em>description</em>: placeholder used in derived type specifications where
none of the above types apply</p>
<p class="last"><em>usage</em>: only in derived types</p>
</dd>
<dt>spaced_list</dt>
<dd><p class="first"><em>description</em>: used to signify a space separated list such as
<code class="docutils literal notranslate"><span class="pre">&quot;Foo&quot;</span> <span class="pre">50</span> <span class="pre">False</span></code>.</p>
<p><em>usage</em>: use for inputs that expect a string that contains a number
of space separated items - e.g. in <code class="docutils literal notranslate"><span class="pre">fcm_make</span></code> app configs.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all inputs need to have <code class="docutils literal notranslate"><span class="pre">type</span></code> defined. In some cases using
<code class="docutils literal notranslate"><span class="pre">values</span></code> or <code class="docutils literal notranslate"><span class="pre">pattern</span></code> is better.</p>
</div>
</dd>
</dl>
<p>A derived type may be defined by a comma <code class="docutils literal notranslate"><span class="pre">,</span></code> separated list of
intrinsic types, e.g. <code class="docutils literal notranslate"><span class="pre">integer,</span> <span class="pre">character,</span> <span class="pre">real,</span> <span class="pre">integer</span></code>. The
default is a raw string.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]length">
<em class="property">Config </em><code class="descname">length</code></dt>
<dd><p>Define the length of an array. If not present, the setting is assumed
to be a scalar. A positive integer defines a fixed length array. A
colon <code class="docutils literal notranslate"><span class="pre">:</span></code> defines a dynamic length array.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You do not need to use <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]length" title="rose:conf:rose-meta.conf[SETTING]length"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">length</span></code></a> if you already have
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]type" title="rose:conf:rose-meta.conf[SETTING]type"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">type=python_list</span></code></a> for a setting.</p>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]element-titles">
<em class="property">Config </em><code class="descname">element-titles</code></dt>
<dd><p>Define a list of comma separated “titles” to appear above array
entries. If not present then no titles are displayed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Where the number of <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]element-titles" title="rose:conf:rose-meta.conf[SETTING]element-titles"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">element-titles</span></code></a> is greater than
the length of the array, it will only display titles up to the
length of the array.
Additionally, where the associated array is longer than the number
of <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]element-titles" title="rose:conf:rose-meta.conf[SETTING]element-titles"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">element-titles</span></code></a>, blank headings will be placed above
them.</p>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]values">
<em class="property">Config </em><code class="descname">values</code></dt>
<dd><p>Define a comma <code class="docutils literal notranslate"><span class="pre">,</span></code> separated list of permitted values of a setting
(or an element in the setting if it is an array). This metadata
overrides the <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]type" title="rose:conf:rose-meta.conf[SETTING]type"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">type</span></code></a>, <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]range" title="rose:conf:rose-meta.conf[SETTING]range"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">range</span></code></a> and
:rose:conf`pattern` metadata.</p>
<p>For example, <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> may use this list to
determine the widget
to display the setting. It may display the choices using a set of radio
buttons if the list of values is small, or a drop down combo box if the
list of <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]values" title="rose:conf:rose-meta.conf[SETTING]values"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">values</span></code></a> is large. If the list only contains one
value, <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will expect the setting to
always have this value, and may display it as a special setting.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]value-titles">
<em class="property">Config </em><code class="descname">value-titles</code></dt>
<dd><p>Define a comma <code class="docutils literal notranslate"><span class="pre">,</span></code> separated list of titles to associate with each
of the elements of <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]values" title="rose:conf:rose-meta.conf[SETTING]values"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">values</span></code></a> which will be displayed
instead of the value. This list should contain the same number of
elements as the <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]values" title="rose:conf:rose-meta.conf[SETTING]values"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">values</span></code></a> entry.</p>
<p>For example, given the following metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=HEAT]</span>
<span class="nv">values</span><span class="o">=</span><span class="s">0, 1, 2</span>
<span class="nv">value-titles</span><span class="o">=</span><span class="s">low, medium, high</span>
</pre></div>
</div>
<p><a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will display <code class="docutils literal notranslate"><span class="pre">low</span></code> for option value
<code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">medium</span></code> for <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">high</span></code> for <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]value-hints">
<em class="property">Config </em><code class="descname">value-hints</code></dt>
<dd><p>Define a comma <code class="docutils literal notranslate"><span class="pre">,</span></code> separated list of suggested values for a variable
as value “hints”, but still allows the user to provide their own
override. This is like an auto-complete widget.</p>
<p>For example, given the following metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=suggested_fruit]</span>
<span class="nv">value-hints</span><span class="o">=</span><span class="s">pineapple,cherry,banana,apple,pear,mango,kiwi,grapes,peach,fig,</span>
           <span class="o">=</span><span class="s">orange,strawberry,blackberry,blackcurrent,raspberry,melon,plum</span>
</pre></div>
</div>
<p><a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will display possible option values when
the user starts typing if they match a suggested value.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]range">
<em class="property">Config </em><code class="descname">range</code></dt>
<dd><p>Specify a range of values. It can either be a simple comma <code class="docutils literal notranslate"><span class="pre">,</span></code>
separated list of allowed values, or a logical expression in the Rose
metadata <a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">mini-language</span></a>. This metadata is
only valid if <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]type" title="rose:conf:rose-meta.conf[SETTING]type"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">type</span></code></a> is either <code class="docutils literal notranslate"><span class="pre">integer</span></code> or <code class="docutils literal notranslate"><span class="pre">real</span></code>.</p>
<p>A simple list may contain a mixture of allowed numbers and number
ranges such as <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">4:8,</span> <span class="pre">10:</span></code> (which means the value can be 1, 2,
between 4 and 8 inclusive, or any values greater than or equal to 10.)</p>
<p>A logical expression uses the Rose metadata
<a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">mini-language</span></a>, using the variable <code class="docutils literal notranslate"><span class="pre">this</span></code>
to denote the value of the current setting, e.g.
<code class="docutils literal notranslate"><span class="pre">this</span> <span class="pre">&lt;-1</span> <span class="pre">and</span> <span class="pre">this</span> <span class="pre">&gt;1</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Inter-variable comparisons are not permitted (but see the <code class="docutils literal notranslate"><span class="pre">fail-if</span></code>
property below for a way to implement this).</p>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]pattern">
<em class="property">Config </em><code class="descname">pattern</code></dt>
<dd><p>Specify a regular expression (<a class="reference external" href="https://docs.python.org/2/library/re.html#regular-expression-syntax">Python Regular Expressions</a>) to
compare against the whole value of the setting.</p>
<p>For example, if we write the following metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:cheese=country_of_origin]</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s">^&quot;[A-Z].+&quot;$</span>
</pre></div>
</div>
<p>then we expect all valid values for <code class="docutils literal notranslate"><span class="pre">country_of_origin</span></code> to start with
a double quote (<code class="docutils literal notranslate"><span class="pre">^&quot;</span></code>), begin with an uppercase letter (<code class="docutils literal notranslate"><span class="pre">[A-Z]</span></code>),
contain some other characters or spaces (<code class="docutils literal notranslate"><span class="pre">.+</span></code>), and end with a quote
(<code class="docutils literal notranslate"><span class="pre">&quot;$</span></code>).</p>
<p>If you have an array variable (for example,
<code class="docutils literal notranslate"><span class="pre">TARTAN_PAINT_COLOURS='blue','red','blue'</span></code>) and you want to specify a
pattern that each element of the array must match, you can construct a
regular expression that repeats and includes commas. For example, if
each element in our <code class="docutils literal notranslate"><span class="pre">TARTAN_PAINT_COLOURS</span></code> array must obey the
regular expression <code class="docutils literal notranslate"><span class="pre">'red'|'blue'</span></code>, then we can write:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=TARTAN_PAINT_COLOURS]</span>
<span class="nv">length</span><span class="o">=</span><span class="s">:</span>
<span class="nv">pattern</span><span class="o">=</span><span class="s">^(&#39;red&#39;|&#39;blue&#39;)(?:,(&#39;red&#39;|&#39;blue&#39;))*$</span>
</pre></div>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]fail-if">
<em class="property">Config </em><code class="descname">fail-if</code></dt>
<dd><p>Specify a logical expression using the Rose
<a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">mini-language</span></a> to validate the
value of the current setting with respect to other settings. If the
logical expression evaluates to true, the system will
consider the setting in error.</p>
<p>See the associated setting <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]warn-if" title="rose:conf:rose-meta.conf[SETTING]warn-if"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">warn-if</span></code></a> for raising warnings.</p>
<p>The logical expression uses a Python-like syntax (documented in the
<a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">appendix</span></a>). It can reference the value of
the current setting with the <code class="docutils literal notranslate"><span class="pre">this</span></code> variable and the value of other
settings with their IDs. E.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:test=my_test_var]</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">this &lt; namelist:test=control_lt_var;</span>
</pre></div>
</div>
<p>means that an error will be flagged if the numeric value of
<code class="docutils literal notranslate"><span class="pre">my_test_var</span></code> is less than the numeric value of <code class="docutils literal notranslate"><span class="pre">control_lt_var</span></code>.</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">this != 1 + namelist:test=ctrl_var_1 * (namelist:test=ctrl_var_2 - this);</span>
</pre></div>
</div>
<p>shows a more complex operation, again with numeric values.</p>
<p>To check array elements, the ID should be expressed with a bracketed
index, as in the configuration:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">this(2) != &quot;&#39;0A&#39;&quot; and this(4) == &quot;&#39;0A&#39;&quot;;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With array elements indexing starts from 1.</p>
</div>
<p>Array elements can also be checked using <code class="docutils literal notranslate"><span class="pre">any</span></code> and <code class="docutils literal notranslate"><span class="pre">all</span></code>. E.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">any(namelist:test=ctrl_array &lt; this);</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">all(this == 0);</span>
</pre></div>
</div>
<p>Similarly, the number of array elements can be checked using <code class="docutils literal notranslate"><span class="pre">len</span></code>.
E.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">len(namelist:test=ctrl_array) &lt; this;</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">len(this) == 0;</span>
</pre></div>
</div>
<p>Expressions can be chained together and brackets used:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">this(4) == &quot;&#39;0A&#39;&quot; and (namelist:test=ctrl_var_1 != &quot;&#39;N&#39;&quot; or</span>
<span class="nv">namelist:test</span><span class="o">=</span><span class="s">ctrl_var_2 != &quot;&#39;Y&#39;&quot; or all(namelist:test=ctrl_arr_3 == &#39;N&#39;));</span>
</pre></div>
</div>
<p>Multiple failure conditions can be added, by using a semicolon as the
separator - the semicolon is optional for a single statement or the
last in a block, but is recommended. Multiple failure conditions are
essentially similar to chaining them together with <code class="docutils literal notranslate"><span class="pre">or</span></code>, but the
system can process each expression one by one to target the error
message.</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">this &gt; 0; this % 2 == 1; this * 3 &gt; 100;</span>
</pre></div>
</div>
<p>You can add a message to the error or warning message to make it
clearer by adding a hash followed by the comment at the end of a
configuration metadata line:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="c1"># Need common divisor for ctrl_array</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">any(namelist:test=ctrl_array % this == 0);</span>
</pre></div>
</div>
<p>When using multiple failure conditions, different messages can be added
if they are placed on individual lines:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">fail-if</span><span class="o">=</span><span class="s">this &gt; 0; # Needs to be less than or equal to 0</span>
        <span class="s">this % 2 == 1; # Needs to be odd</span>
        <span class="s">this * 3 &gt; 100; # Needs to be more than 100/3.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When dividing a real-numbered setting by something, make
sure that the expression does not actually divide an integer by an
integer - for example, <code class="docutils literal notranslate"><span class="pre">this</span> <span class="pre">/</span> <span class="pre">2</span></code> will evaluate as <code class="docutils literal notranslate"><span class="pre">0</span></code> if
<code class="docutils literal notranslate"><span class="pre">this</span></code> has a value of <code class="docutils literal notranslate"><span class="pre">1</span></code>, but <code class="docutils literal notranslate"><span class="pre">0.5</span></code> if it has a value of
<code class="docutils literal notranslate"><span class="pre">1.0</span></code>. This is a result of Python’s implicit typing.</p>
<p class="last">You can get around this by making sure either the numerator or
denominator is a real number - e.g. by rewriting it as
<code class="docutils literal notranslate"><span class="pre">this</span> <span class="pre">/</span> <span class="pre">2.0</span></code> or <code class="docutils literal notranslate"><span class="pre">1.0</span> <span class="pre">*</span> <span class="pre">this</span> <span class="pre">/</span> <span class="pre">2</span></code>.</p>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]warn-if">
<em class="property">Config </em><code class="descname">warn-if</code></dt>
<dd><p>Specify a logical expression using the Rose
<a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">mini-language</span></a> to validate the
value of the current setting with respect to other settings. If
the logical expression evaluates to true, the system will
issue a warning. It is a slightly different usage of the
<code class="docutils literal notranslate"><span class="pre">fail-if</span></code> functionality which can do things like warn of
deprecated content, e.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">warn-if</span><span class="o">=</span><span class="s">True;</span>
</pre></div>
</div>
<p>would always evaluate <code class="docutils literal notranslate"><span class="pre">True</span></code> and give a warning if the
setting is present.</p>
<p>See the associated setting <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]fail-if" title="rose:conf:rose-meta.conf[SETTING]fail-if"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">fail-if</span></code></a> for examples of
logical expressions that may be added.</p>
</dd></dl>

<p class="rubric" id="metadata-behaviour">Metadata for Behaviour</p>
<p>These metadata are used to define how the setting should behave in
different states.</p>
<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]compulsory">
<em class="property">Config </em><code class="descname">compulsory</code></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">true</span></code> value indicates that the setting should be compulsory. If
this flag is not set, the setting is optional.</p>
<p>Compulsory sections should be physically present in the configuration
at all times. Compulsory options should be physically present in the
configuration if their parent section is physically present.</p>
<p>Optional settings can be removed as the user wishes. Compulsory
settings may however be triggered ignored (see <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]trigger" title="rose:conf:rose-meta.conf[SETTING]trigger"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">trigger</span></code></a>).
For example, the <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> may issue a warning
if a compulsory setting is not defined. It may also hide a compulsory
variable that only has a single permitted value.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]trigger">
<em class="property">Config </em><code class="descname">trigger</code></dt>
<dd><p>A setting has the following states:</p>
<ul class="simple">
<li>normal</li>
<li>user ignored (stored in the configuration file with a <code class="docutils literal notranslate"><span class="pre">!</span></code> flag,
ignored at run time)</li>
<li>logically ignored (stored in the configuration file with a <code class="docutils literal notranslate"><span class="pre">!!</span></code>
flag, ignored at runtime)</li>
</ul>
<p>If a setting is user ignored, the trigger will do nothing. Otherwise:</p>
<ul class="simple">
<li>If the logic for a setting in the trigger is fulfilled, it will cause
the setting to be enabled.</li>
<li>If it is not, it will cause the setting to be logically ignored.</li>
</ul>
<p>The trigger expression is a list of settings triggered by (different
values of) this setting. If the values are not given, the setting will
be triggered only if the current setting is enabled.</p>
<p>The syntax contains ID-value pairs, where the values part is optional.
Each pair must be separated by a semi-colon. Within each pair, any
values must be separated from the ID by a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) and a space.
Values must be formatted in the same way as the setting
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]values" title="rose:conf:rose-meta.conf[SETTING]values"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">values</span></code></a> defined above (i.e. comma separated).</p>
<p>The trigger syntax looks like:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:trig_nl=trigger_variable]</span>
<span class="nv">trigger</span><span class="o">=</span><span class="s">namelist:dep_nl=A;</span>
        <span class="s">namelist:dep_nl=B;</span>
        <span class="s">namelist:value_nl=X: 10;</span>
        <span class="s">env=Y: 20, 30, 40;</span>
        <span class="s">namelist:value_nl=Z: 20;</span>
</pre></div>
</div>
<p>In this example:</p>
<ul class="simple">
<li>When <code class="docutils literal notranslate"><span class="pre">namelist:trig_nl=trigger_variable</span></code> is ignored, all the
variables in the trigger expression will be ignored, irrespective of
its value.</li>
<li>When <code class="docutils literal notranslate"><span class="pre">namelist:trig_nl=trigger_variable</span></code> is enabled,
<code class="docutils literal notranslate"><span class="pre">namelist:dep_nl=A</span></code> and <code class="docutils literal notranslate"><span class="pre">namelist:dep_nl=B</span></code> will both be enabled,
and the other variables may be enabled according to its value:<ul>
<li>When the value of the setting is not <code class="docutils literal notranslate"><span class="pre">10</span></code>, <code class="docutils literal notranslate"><span class="pre">20</span></code>, <code class="docutils literal notranslate"><span class="pre">30</span></code>, or
<code class="docutils literal notranslate"><span class="pre">40</span></code>, <code class="docutils literal notranslate"><span class="pre">namelist:value_nl=X</span></code>, <code class="docutils literal notranslate"><span class="pre">env=Y</span></code> and
<code class="docutils literal notranslate"><span class="pre">namelist:value_nl=Z</span></code> will be ignored.</li>
<li>When the value of the setting is <code class="docutils literal notranslate"><span class="pre">10</span></code>, <code class="docutils literal notranslate"><span class="pre">namelist:value_nl=X</span></code>
will be enabled, but <code class="docutils literal notranslate"><span class="pre">env=Y</span></code> and <code class="docutils literal notranslate"><span class="pre">namelist:value_nl=Z</span></code> will be
ignored.</li>
<li>When the value of the setting is <code class="docutils literal notranslate"><span class="pre">20</span></code>, <code class="docutils literal notranslate"><span class="pre">env=Y</span></code> and
<code class="docutils literal notranslate"><span class="pre">namelist:value_nl=Z</span></code> will be enabled, but
<code class="docutils literal notranslate"><span class="pre">namelist:value_nl=X</span></code> will be ignored.</li>
<li>When the value of the setting is <code class="docutils literal notranslate"><span class="pre">30</span></code>, <code class="docutils literal notranslate"><span class="pre">env=Y</span></code> will be enabled,
but <code class="docutils literal notranslate"><span class="pre">namelist:value_nl=X</span></code> and <code class="docutils literal notranslate"><span class="pre">namelist:value_nl=Z</span></code> will be
ignored.</li>
<li>If the value of the setting contains an environment
variable-like string, e.g. <code class="docutils literal notranslate"><span class="pre">${TEN_MULTIPLE}</span></code>, all three will be
enabled.</li>
</ul>
</li>
</ul>
<p>Settings mentioned in trigger expressions will have their default
state set to ignored unless explicitly triggered.
<a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will issue warnings if variables or
sections are in the incorrect state when it loads a configuration.
Triggering thereafter will work as normal.</p>
<p>Where multiple triggers act on a setting, the setting is triggered only
if all triggers are active (i.e. an <em>AND</em> relationship). For example,
for the two triggers here:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=IS_WATER]</span>
<span class="nv">trigger</span><span class="o">=</span><span class="s">env=IS_ICE: true;</span>

<span class="nt">[env=IS_COLD]</span>
<span class="nv">trigger</span><span class="o">=</span><span class="s">env=IS_ICE: true;</span>
</pre></div>
</div>
<p>the setting <code class="docutils literal notranslate"><span class="pre">env=IS_ICE</span></code> is only enabled if both <code class="docutils literal notranslate"><span class="pre">env=IS_WATER</span></code> and
<code class="docutils literal notranslate"><span class="pre">env=IS_COLD</span></code> are <code class="docutils literal notranslate"><span class="pre">true</span></code> and enabled. Otherwise, it is ignored.</p>
<p>The trigger syntax also supports a logical expression using the Rose
metadata <a class="reference internal" href="#app-meta-mini-lang"><span class="std std-ref">mini-language</span></a>, in the same way as
the <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]range" title="rose:conf:rose-meta.conf[SETTING]range"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">range</span></code></a> or <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]fail-if" title="rose:conf:rose-meta.conf[SETTING]fail-if"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">fail-if</span></code></a> metadata. As with
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]range" title="rose:conf:rose-meta.conf[SETTING]range"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">range</span></code></a>, inter-variable comparisons are disallowed.</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[env=SNOWFLAKE_SIDES]</span>
<span class="nv">trigger</span><span class="o">=</span><span class="s">env=CUSTOM_SNOWFLAKE_GEOMETRY: this != 6;</span>
        <span class="s">env=SILLY_SNOWFLAKE_GEOMETRY: this &lt; 2;</span>
</pre></div>
</div>
<p>In this example, the setting <code class="docutils literal notranslate"><span class="pre">env=CUSTOM_SNOWFLAKE_GEOMETRY</span></code> is
enabled if <code class="docutils literal notranslate"><span class="pre">env=SNOWFLAKE_SIDES</span></code> is enabled and not <code class="docutils literal notranslate"><span class="pre">6</span></code>.
<code class="docutils literal notranslate"><span class="pre">env=SILLY_SNOWFLAKE_GEOMETRY</span></code> is only enabled when
<code class="docutils literal notranslate"><span class="pre">env=SNOWFLAKE_SIDES</span></code> is enabled and less than <code class="docutils literal notranslate"><span class="pre">2</span></code>. The logical
expression syntax can be used with non-numeric variables in the same
way as the fail-if metadata.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]duplicate">
<em class="property">Config </em><code class="descname">duplicate</code></dt>
<dd><p>Allow duplicated copies of the setting. This is used for sections where
there may be more than one with the same metadata - for example
multiple namelist groups of the same name. If this setting is true for
a given name, the application configuration will accept multiple
namelist groups of this name. <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> may then
provide the option to clone or copy a namelist to generate an
additional namelist. Otherwise, <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> may
issue warning for configuration sections that are found with multiple
copies or an index.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]macro">
<em class="property">Config </em><code class="descname">macro</code></dt>
<dd><blockquote>
<div><p>Associate a setting with a comma-delimited set of custom macros (but
not upgrade macros).</p>
<p>E.g. for a macro class called <code class="docutils literal notranslate"><span class="pre">FibonacciChecker</span></code> in the metadata
under <code class="docutils literal notranslate"><span class="pre">lib/python/macros/fib.py</span></code>, we may have:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">macro</span><span class="o">=</span><span class="s">fib.FibonacciChecker</span>
</pre></div>
</div>
<p>This may be used in <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> to visually
associate the setting with these macros. If a macro class has both a
<code class="docutils literal notranslate"><span class="pre">transform</span></code> and a <code class="docutils literal notranslate"><span class="pre">validate</span></code> method, you can specify which you need
by appending the method to the name e.g.:</p>
</div></blockquote>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">macro</span><span class="o">=</span><span class="s">fib.Fibonacci.validate</span>
</pre></div>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]widget[gui-application]">
<em class="property">Config </em><code class="descname">widget[gui-application]</code></dt>
<dd><p>Indicate that the gui-application (e.g.
<a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a>) should use a special widget to display
this setting.</p>
<p>E.g. If we want to use a slider instead of an entry box for a floating
point real number.</p>
<p>The widget may take space-delimited arguments which would be specified
after the widget name. E.g. to set up a hypothetical table with named
columns X, Y, VCT, and Level, we may do:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">widget[rose-config-edit]</span><span class="o">=</span><span class="s">table.TableWidget X Y VCT Level</span>
</pre></div>
</div>
<p>You may override to a Rose built-in widget by specifying a full
<code class="docutils literal notranslate"><span class="pre">rose</span></code> class path in Python - for example, to always show
radiobuttons for an option with <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]values" title="rose:conf:rose-meta.conf[SETTING]values"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">values</span></code></a> set:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">widget[rose-config-edit]</span><span class="o">=</span><span class="s">rose.config_editor.valuewidget.radiobuttons.RadioButtonsValueWidget</span>
</pre></div>
</div>
<p>Another useful Rose built-in widget to use is the array element
aligning <a class="reference internal" href="../rose-gtk-library.html#conf-ed-cust-pages"><span class="std std-ref">page widget</span></a>,
<code class="docutils literal notranslate"><span class="pre">rose.config_editor.pagewidget.table.PageArrayTable</span></code>. You can set
this for a section or namespace to make sure each <em>n</em>-th variable value
element lines up horizontally. For example:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:meal_choices]</span>
<span class="nv">customers</span><span class="o">=</span><span class="s">&#39;Athos&#39;,&#39;Porthos&#39;,&#39;Aramis&#39;,&#39;d&#39;&#39;Artagnan&#39;</span>
<span class="nv">entrees</span><span class="o">=</span><span class="s">&#39;soup&#39;,&#39;pate&#39;,&#39;soup&#39;,&#39;asparagus&#39;</span>
<span class="nv">main</span><span class="o">=</span><span class="s">&#39;beef&#39;,&#39;spaghetti&#39;,&#39;coq au vin&#39;,&#39;lamb&#39;</span>
<span class="nv">petits_fours</span><span class="o">=</span><span class="s">.false.,.true.,.false.,.true.</span>
</pre></div>
</div>
<p>could use the following metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:meal_choices]</span>
<span class="nv">widget[rose-config-edit]</span><span class="o">=</span><span class="s">rose.config_editor.pagewidget.table.PageArrayTable</span>
</pre></div>
</div>
<p>to align the elements on the page like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>customers        Athos      Porthos      Aramis      d&#39;Artagnan
entrees          soup        pate         soup       asparagus
main             beef      spaghetti   coq au vin       lamb
petits_fours    .false.     .true.       .false.       .true.
</pre></div>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]copy-mode">
<em class="property">Config </em><code class="descname">copy-mode</code></dt>
<dd><p>For use with settings in the <a class="reference internal" href="suite.html#rose:file:rose-suite.info" title="rose:file:rose-suite.info"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-suite.info</span></code></a> file.</p>
<p>Setting <a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]copy-mode" title="rose:conf:rose-meta.conf[SETTING]copy-mode"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">copy-mode</span></code></a> in the metadata allows for the field to
be either <code class="docutils literal notranslate"><span class="pre">never</span></code> copied or copied with any value associated to be
<code class="docutils literal notranslate"><span class="pre">clear</span></code>.</p>
<p>For example: in a <a class="reference internal" href="suite.html#rose:file:rose-suite.info" title="rose:file:rose-suite.info"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-suite.info</span></code></a> file:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[ensemble members]</span>
<span class="nv">copy-mode</span><span class="o">=</span><span class="s">never</span>
</pre></div>
</div>
<p>Setting the <code class="docutils literal notranslate"><span class="pre">ensemble</span> <span class="pre">members</span></code> field to include <code class="docutils literal notranslate"><span class="pre">copy-mode=never</span></code>
means that the ensemble members field would never be copied.</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[additional info]</span>
<span class="nv">copy-mode</span><span class="o">=</span><span class="s">clear</span>
</pre></div>
</div>
<p>Setting the <code class="docutils literal notranslate"><span class="pre">additional</span> <span class="pre">info</span></code> field to include <code class="docutils literal notranslate"><span class="pre">copy-mode=never</span></code>
means that the additional info field would be copied, but any value
associated with it would be cleared.</p>
</dd></dl>

<p class="rubric" id="metadata-help">Metadata for Help</p>
<p>These metadata provide help for a configuration.</p>
<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]url">
<em class="property">Config </em><code class="descname">url</code></dt>
<dd><p>A web URL containing help for the setting. For example:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">url</span><span class="o">=</span><span class="s">http://www.something.com/FOO/view/dev/doc/FOO.html</span>
</pre></div>
</div>
<p>For example, the <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will trigger a web
browser to display this when a variable name is clicked. A partial URL
can be used for variables if the variable’s section or namespace has a
relevant parent <code class="docutils literal notranslate"><span class="pre">url</span></code> property to use as a prefix. For example:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:foo]</span>
<span class="nv">url</span><span class="o">=</span><span class="s">https://www.google.com/search</span>

<span class="nt">[namelist:foo=bar]</span>
<span class="nv">url</span><span class="o">=</span><span class="s">?q=nearest+bar</span>
</pre></div>
</div>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]help">
<em class="property">Config </em><code class="descname">help</code></dt>
<dd><p>(Long) help for the setting. For example,
<a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will use this in a pop-up dialog for
a variable. Embedding variable IDs in the help string will allow
links to the variables to be created within the pop-up dialog box,
e.g.</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">help</span><span class="o">=</span><span class="s">Used in conjunction with namelist:Var_DiagnosticsNL=n_linear_adj_test to do something linear.</span>
</pre></div>
</div>
<p>Web URLs beginning with <code class="docutils literal notranslate"><span class="pre">http://</span></code> will also be presented as links in
the <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a>.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]description">
<em class="property">Config </em><code class="descname">description</code></dt>
<dd><p>(Medium) description for the setting. For example,
<a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will use this as part of the hover over
text.</p>
<p><a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> will also use descriptions set for
sections or namespaces as page header text (appears at the top of a
panel or page), with clickable ID and URL links as in help.
Descriptions set for variables may be automatically shown underneath
the variable name in <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a>, depending on
view options.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose-meta.conf[SETTING]title">
<em class="property">Config </em><code class="descname">title</code></dt>
<dd><p>(Short) title for the setting. For example,
<a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> can use this specification as the label
of a setting, instead of the variable name.</p>
</dd></dl>

</dd></dl>

</dd></dl>





</article>
<article class="slide level-2" id="appendix-metadata-location">

<h2>Appendix: Metadata Location<a class="headerlink" href="../../../html/api/configuration/metadata.html#appendix-metadata-location" title="View HTML">§</a></h2>

<p>Centralised Rose metadata is referred to with either the
<a class="reference internal" href="suite.html#rose:conf:rose-suite.conf|meta" title="rose:conf:rose-suite.conf|meta"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-suite.conf|meta</span></code></a> or <a class="reference internal" href="suite.html#rose:conf:rose-suite.info|project" title="rose:conf:rose-suite.info|project"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-suite.info|project</span></code></a>
settings in a suite configuration. It needs to live in a
system-global-readable location.</p>
<p>Rose utilities will do a path search for metadata using the following in
order of precedence:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">--meta-path=PATH</span></code> option of relevant commands.</li>
<li>The content of the <span class="target" id="index-1"></span><a class="reference internal" href="../environment-variables.html#envvar-ROSE_META_PATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ROSE_META_PATH</span></code></a> environment variable.</li>
<li>The <a class="reference internal" href="site-and-user.html#rose:conf:rose.conf|meta-path" title="rose:conf:rose.conf|meta-path"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose.conf|meta-path</span></code></a> setting (see <a class="reference internal" href="site-and-user.html#site-and-user-configuration"><span class="std std-ref">Site And User Configuration</span></a>).</li>
</ul>
<p>Each of the above settings can be a colon-separated list of paths.</p>
<p>Underneath each directory in the search path should be a hierarchy like the
following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="si">${</span><span class="nv">APP</span><span class="si">}</span>/HEAD/
<span class="si">${</span><span class="nv">APP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>/
<span class="si">${</span><span class="nv">APP</span><span class="si">}</span>/versions.py <span class="c1"># i.e. the upgrade macros</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A <a class="reference internal" href="suite.html#rose:file:rose-suite.info" title="rose:file:rose-suite.info"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-suite.info</span></code></a> is likely to have no versions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In some cases, a number of different executables may share the
same application configuration metadata in which case <code class="docutils literal notranslate"><span class="pre">APP</span></code> is given a
name which covers all the uses.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The Rose team recommend placing metadata in a <code class="docutils literal notranslate"><span class="pre">rose-meta</span></code> directory at
the top of a project’s source tree. Central metadata, if any, at the
<code class="docutils literal notranslate"><span class="pre">meta-path</span></code> location in the site configuration, should be a collection
of regularly-updated subdirectories from all of the relevant projects’
<code class="docutils literal notranslate"><span class="pre">rose-meta</span></code> directories.</p>
<p>For example, a system <code class="docutils literal notranslate"><span class="pre">CHOCOLATE</span></code> may have a flat metadata structure
within the repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CHOCOLATE/doc/
...
CHOCOLATE/rose-meta/
CHOCOLATE/rose-meta/choc-dark/
CHOCOLATE/rose-meta/choc-milk/
</pre></div>
</div>
<p>and the system <code class="docutils literal notranslate"><span class="pre">CAFFEINE</span></code> may have a hybrid structure, with both flat
and hierarchical components:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CAFFEINE/doc/
...
CAFFEINE/rose-meta/caffeine-guarana/
CAFFEINE/rose-meta/caffeine-coffee/cappuccino/
CAFFEINE/rose-meta/caffeine-coffee/latte/
CAFFEINE/rose-meta/caffeine-tea/yorkshire/
CAFFEINE/rose-meta/caffeine-tea/lapsang/
</pre></div>
</div>
<p>and a site configuration with:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">meta-path</span><span class="o">=</span><span class="s">/path/to/rose-meta</span>
</pre></div>
</div>
<p>We would expect the following directories in <code class="docutils literal notranslate"><span class="pre">/path/to/rose-meta</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/path/to/rose-meta/caffeine-guarana/
/path/to/rose-meta/caffeine-coffee/
/path/to/rose-meta/caffeine-tea/
/path/to/rose-meta/choc-dark/
/path/to/rose-meta/choc-milk/
</pre></div>
</div>
<p class="last">with <code class="docutils literal notranslate"><span class="pre">caffeine-coffee</span></code> containing subdirectories <code class="docutils literal notranslate"><span class="pre">cappuccino</span></code> and
<code class="docutils literal notranslate"><span class="pre">latte</span></code>, and <code class="docutils literal notranslate"><span class="pre">caffeine-tea</span></code> containing <code class="docutils literal notranslate"><span class="pre">yorkshire</span></code> and <code class="docutils literal notranslate"><span class="pre">lapsang</span></code>.</p>
</div>




</article>
<article class="slide level-2" id="upgrade-and-versions">

<h2>Upgrade and Versions<a class="headerlink" href="../../../html/api/configuration/metadata.html#upgrade-and-versions" title="View HTML">§</a></h2>

<p>Terminology:</p>
<dl class="docutils">
<dt>The HEAD (i.e. development) version</dt>
<dd>The configuration metadata most relevant to the latest revision of the
source tree.</dd>
<dt>A named version</dt>
<dd>The configuration metadata most relevant to a release, or a particular
revision, of the software. This will normally be a copy of the HEAD version
at a given revision, although it may be updated with some backward
compatible fixes.</dd>
</dl>
<p>Each change in the HEAD version that requires an upgrade procedure should
introduce an upgrade macro. Each upgrade macro will provide the following
information:</p>
<ul class="simple">
<li>A tag of the configuration which can be applied by this macro (i.e. the
previous tag).</li>
<li>A tag of the configuration after the transformation.</li>
</ul>
<p>This allows our system to build up a chain if multiple upgrades need to be
applied. The tag can be any name, but will normally refer to the ticket
number that introduces the change.</p>
<p>Every new upgrade macro creates a new tagged version. A named version is
simply a tagged version for which a copy of the relevant configuration
metadata is made available.</p>
<p>Named versions for system releases are typically created at the end of the
release process. The associated upgrade macro is typically only required in
order to create the new name tag and, therefore, does not normally alter the
application configuration.</p>
<p>Application configurations can reference the configuration metadata as
follows:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="c1">#!cfg</span>
<span class="c1"># Refer to the HEAD version</span>
<span class="c1"># (typically you wouldn&#39;t do this since no upgrade process is possible)</span>
<span class="c1"># For flat metadata</span>
<span class="nv">meta</span><span class="o">=</span><span class="s">my-command</span>
<span class="c1"># For hierarchical metadata</span>
<span class="nv">meta</span><span class="o">=</span><span class="s">/path/to/metadata/my-command/HEAD</span>

<span class="c1"># Refer to a named or tagged version in the flat metadata</span>
<span class="nv">meta</span><span class="o">=</span><span class="s">my-command/8.3</span>
<span class="nv">meta</span><span class="o">=</span><span class="s">my-command/t123</span>
<span class="c1"># Refer to a named or tagged version in the hierarchical metadata</span>
<span class="nv">meta</span><span class="o">=</span><span class="s">/path/to/metadata/my-command/8.3</span>
</pre></div>
</div>
<p>If a version is defined then the Rose utilities will first look for the
corresponding named version. If this cannot be found then the HEAD version
is used and, if an upgrade is available, a warning will be given to indicate
that the configuration metadata being used requires upgrade macros to be run.
If the version defined does not correspond to a tagged version then a warning
will be given.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a hierarchical structure for the metadata is being used,
the <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> tag must be specified explictly.</p>
</div>




</article>
<article class="slide level-3" id="when-to-create-named-versions">

<h3>When to create named versions<a class="headerlink" href="../../../html/api/configuration/metadata.html#when-to-create-named-versions" title="View HTML">§</a></h3>

<p>One option is to create a new named version for each release of your system.
This makes it easy for users to understand. However, if there is a new
release which does not require a change to the metadata then you will still
have to create a new copy and force the user to go through a null upgrade
which may not be desirable. An alternative is to only create a new named
version at releases which require changes. The name then indicates the
metadata is relevant for a particular release and all subsequent releases
(unless an upgrade macro is available to a later release).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is also possible to make any tagged version between releases a named
version, but it will usually be better not to. In which case, the user
will be using HEAD and will be prompted to upgrade (which is probably what
you want if you’re not using a release).</p>
</div>




</article>
<article class="slide level-3" id="sharing-metadata-between-different-executables">

<h3>Sharing metadata between different executables<a class="headerlink" href="../../../html/api/configuration/metadata.html#sharing-metadata-between-different-executables" title="View HTML">§</a></h3>

<p>If two different commands share the majority of their inputs then you may
choose to use the same configuration metadata for both commands. Any
differences (in terms of available inputs) can then be triggered by the
command in use. Whether this is desirable will partly depend on how many of
the inputs are shared.</p>
<p>One downside of sharing metadata is that your application configuration may
contain (ignored) settings which have no relevance to the command you are
using.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We intend to introduce support for configuration metadata to
include / inherit from other metadata. This may mean that it makes sense
to have separate metadata for different commands even when the majority
of inputs are shared.</p>
</div>
<p>Another reason you may want to share metadata is if you have two related
commands which you want to configure using the same set of inputs (i.e. a
single application configuration).</p>
<p>This works by setting an alternate command in the application configuration
and then using the <code class="docutils literal notranslate"><span class="pre">--command-key</span></code> option to <a class="reference internal" href="../command-reference.html#command-rose-app-run"><span class="std std-ref">rose app-run</span></a>.</p>




</article>
<article class="slide level-3" id="using-development-versions-of-upgrade-macros">

<h3>Using development versions of upgrade macros<a class="headerlink" href="../../../html/api/configuration/metadata.html#using-development-versions-of-upgrade-macros" title="View HTML">§</a></h3>

<p>Users will be able to test out development versions of the upgrade macros by
adding a working copy of the relevant branch into their metadata search path.
However, care must be taken when doing this. Running the upgrade macro will
change the <a class="reference internal" href="application.html#rose:conf:rose-app.conf|meta" title="rose:conf:rose-app.conf|meta"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-app.conf|meta</span></code></a> setting to refer to the new tag.
If the upgrade macro is
subsequently changed or other upgrade macros are added to the chain prior to
this tag (because they get committed to the trunk first) then this will
result in application configurations which have not gone through the correct
upgrade process. Therefore, when using development versions of the upgrade
macros it is safest to not commit any resulting changes (or to use a branch
of the suite which you are happy to discard).</p>




</article>
<article class="slide level-2" id="metadata-mini-language">

<h2>Metadata Mini-Language<a class="headerlink" href="../../../html/api/configuration/metadata.html#metadata-mini-language" title="View HTML">§</a></h2>

<p>The Rose metadata mini-language supports writing a logical expression in
Python-like syntax, using variable IDs to reference their associated values.</p>
<p>Expressions are set as the value of metadata properties such as
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]fail-if" title="rose:conf:rose-meta.conf[SETTING]fail-if"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-meta.conf[SETTING]fail-if</span></code></a> and
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]range" title="rose:conf:rose-meta.conf[SETTING]range"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-meta.conf[SETTING]range</span></code></a>.</p>
<p>The language is a small sub-set of Python - a limited set of operators is
supported.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No built-in object methods, functions, or modules are
supported - neither are control blocks such as <code class="docutils literal notranslate"><span class="pre">if</span></code>/<code class="docutils literal notranslate"><span class="pre">for</span></code>, statements
such as <code class="docutils literal notranslate"><span class="pre">del</span></code> or <code class="docutils literal notranslate"><span class="pre">with</span></code>, or defining your own functions or classes.
Anything that requires that kind of power should be in proper Python code
as a macro.</p>
</div>
<p>Nevertheless, the language allows considerable power in terms of defining
simple rules for variable values.</p>




</article>
<article class="slide level-3" id="operators">

<h3>Operators<a class="headerlink" href="../../../html/api/configuration/metadata.html#operators" title="View HTML">§</a></h3>

<p>The following <em>numeric</em> operators are supported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+</span>     <span class="c1"># add</span>
<span class="o">-</span>     <span class="c1"># subtract</span>
<span class="o">*</span>     <span class="c1"># multiply</span>
<span class="o">**</span>    <span class="c1"># power or exponent - e.g. 2 ** 3 implies 8</span>
<span class="o">/</span>     <span class="c1"># divide</span>
<span class="o">//</span>    <span class="c1"># integer divide (floor) - e.g. 3 // 2 implies 1</span>
<span class="o">%</span>     <span class="c1"># remainder e.g. 5 % 3 implies 2</span>
</pre></div>
</div>
<p>The following <em>string</em> operators are supported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+</span>      <span class="c1"># concatenate - e.g. &quot;foo&quot; + &quot;bar&quot; implies &quot;foobar&quot;</span>
<span class="o">*</span>      <span class="c1"># self-concatenate some number of times - e.g. &quot;foo&quot; * 2 implies &quot;foofoo&quot;</span>
<span class="o">%</span>      <span class="c1"># formatting - e.g. &quot;foo %s baz&quot; % &quot;bar&quot; implies &quot;foo bar baz&quot;</span>
<span class="ow">in</span>     <span class="c1"># contained in (True/False) - e.g. &quot;oo&quot; in &quot;foobar&quot; implies True</span>
<span class="ow">not</span> <span class="ow">in</span> <span class="c1"># opposite sense of in</span>

<span class="c1"># Where m, n are integers or expressions that evaluate to integers</span>
<span class="c1"># (negative numbers count from the end of the string):</span>
<span class="p">[</span><span class="n">n</span><span class="p">]</span>   <span class="c1"># get nth character from string - e.g. &quot;foo&quot;[1] implies &quot;o&quot;</span>
<span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="c1"># get slice of string from m to n - e.g. &quot;foobar&quot;[1:5] implies &quot;ooba&quot;</span>
<span class="p">[</span><span class="n">m</span><span class="p">:]</span>  <span class="c1"># get slice of string from m onwards - e.g. &quot;foobar&quot;[1:] implies &quot;oobar&quot;</span>
<span class="p">[:</span><span class="n">n</span><span class="p">]</span>  <span class="c1"># get slice of string up to n - e.g. &quot;foobar&quot;[:5] implies &quot;fooba&quot;</span>
</pre></div>
</div>
<p>The following <em>logical</em> operators are supported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ow">and</span>   <span class="c1"># Logical AND</span>
<span class="ow">or</span>    <span class="c1"># Logical OR</span>
<span class="ow">not</span>   <span class="c1"># Logical NOT</span>
</pre></div>
</div>
<p>The following <em>comparison</em> operators are supported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ow">is</span>    <span class="c1"># Is the same object as (usually used for &#39;is none&#39;)</span>
<span class="o">&lt;</span>     <span class="c1"># Less than</span>
<span class="o">&gt;</span>     <span class="c1"># Greater than</span>
<span class="o">==</span>    <span class="c1"># Equal to</span>
<span class="o">&gt;=</span>    <span class="c1"># Greater than or equal to</span>
<span class="o">&lt;=</span>    <span class="c1"># Less than or equal to</span>
<span class="o">!=</span>    <span class="c1"># Not equal to</span>
</pre></div>
</div>
<p>Operator precedence is intended to be the same as Python. However, with the
current choice of language engine, the <code class="docutils literal notranslate"><span class="pre">%</span></code> and <code class="docutils literal notranslate"><span class="pre">//</span></code> operators may not
obey this - make sure you force the correct behaviour using brackets.</p>




</article>
<article class="slide level-3" id="constants">

<h3>Constants<a class="headerlink" href="../../../html/api/configuration/metadata.html#constants" title="View HTML">§</a></h3>

<p>The following are special constants:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">None</span>  <span class="c1"># Python None</span>
<span class="bp">False</span> <span class="c1"># Python False</span>
<span class="bp">True</span>  <span class="c1"># Python True</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="using-variable-ids">

<h3>Using Variable IDs<a class="headerlink" href="../../../html/api/configuration/metadata.html#using-variable-ids" title="View HTML">§</a></h3>

<p>Putting a variable ID in the expression means that when the expression
is evaluated, the string value of the variable is <a class="reference external" href="https://docs.python.org/2/library/ast.html#ast.literal_eval">cast</a> and substituted
into the expression.</p>
<p>For example, if we have a configuration that looks like this:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:zoo]</span>
<span class="nv">num_elephants</span><span class="o">=</span><span class="s">2</span>
<span class="nv">elephant_mood</span><span class="o">=</span><span class="s">&#39;peaceful&#39;</span>
</pre></div>
</div>
<p>and an expression in the configuration metadata:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">namelist:zoo</span><span class="o">=</span><span class="s">elephant_mood != &#39;annoyed&#39; and num_elephants &gt;= 2</span>
</pre></div>
</div>
<p>then the expression would become:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;peaceful&#39; != &#39;annoyed&#39; and 2 &gt;= 2
</pre></div>
</div>
<p>If the variable is not currently available (ignored or missing) then the
expression cannot be evaluated. If inter-variable comparisons are not allowed
for the expression’s parent option (such as with
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]trigger" title="rose:conf:rose-meta.conf[SETTING]trigger"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-meta.conf[SETTING]trigger</span></code></a> and
<a class="reference internal" href="#rose:conf:rose-meta.conf[SETTING]range" title="rose:conf:rose-meta.conf[SETTING]range"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-meta.conf[SETTING]range</span></code></a>)
then referencing other variable IDs is not allowed.</p>
<p>In this case the expression would be false.</p>
<p>You may use <code class="docutils literal notranslate"><span class="pre">this</span></code> as a placeholder for the current variable ID - for
example, the fail-if expression:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:foo=bar]</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">namelist:foo=bar &gt; 100 and namelist:foo=bar % 2 == 1</span>
</pre></div>
</div>
<p>is the same as:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:foo=bar]</span>
<span class="nv">fail-if</span><span class="o">=</span><span class="s">this &gt; 100 and this % 2 == 1</span>
</pre></div>
</div>




</article>
<article class="slide level-3" id="arrays">

<h3>Arrays<a class="headerlink" href="../../../html/api/configuration/metadata.html#arrays" title="View HTML">§</a></h3>

<p>The syntax has some special ways of dealing with variable values that are
arrays - i.e. comma-separated lists.</p>
<p>You can refer to a single element of the value for a given variable ID
(or <code class="docutils literal notranslate"><span class="pre">this</span></code>) by suffixing a number in round brackets - e.g.:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">namelist:foo</span><span class="o">=</span><span class="s">bar(2)</span>
</pre></div>
</div>
<p>references the second element in the value for <code class="docutils literal notranslate"><span class="pre">bar</span></code> in the section
<code class="docutils literal notranslate"><span class="pre">namelist:foo</span></code>. This follows Fortran index numbering and syntax, which
starts at 1 rather than 0, i.e. <code class="docutils literal notranslate"><span class="pre">foo(1)</span></code> references the first element in
the array <code class="docutils literal notranslate"><span class="pre">foo</span></code>.</p>
<p>If we had a configuration:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nt">[namelist:foo]</span>
<span class="nv">bar</span><span class="o">=</span><span class="s">&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">namelist:foo=bar(2)</span></code> would get substituted in an expression with <code class="docutils literal notranslate"><span class="pre">'b'</span></code>
when the expression was evaluated. For example, an expression that contained:</p>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">namelist:foo</span><span class="o">=</span><span class="s">bar(2) == &#39;c&#39;</span>
</pre></div>
</div>
<p>would be evaluated as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;b&#39; == &#39;c&#39;
</pre></div>
</div>
<p>Should you wish to make use of the array length in an expression you can
make use of the <code class="docutils literal notranslate"><span class="pre">len</span></code> function, which behaves in the same manner as the
Python <code class="docutils literal notranslate"><span class="pre">len</span></code> and Fortran <code class="docutils literal notranslate"><span class="pre">size</span></code> equivalents to return the array length.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>len(namelist:foo=bar) &gt; 3
</pre></div>
</div>
<p>would be expanded to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>4 &gt; 3
</pre></div>
</div>
<p>and evaluate as true.</p>
<p>There are two other special array functions, <code class="docutils literal notranslate"><span class="pre">any</span></code> and <code class="docutils literal notranslate"><span class="pre">all</span></code>, which
behave in a similar fashion to their Python and Fortran equivalents, but
have a different syntax.</p>
<p>They allow you to write a shorthand expression within an <code class="docutils literal notranslate"><span class="pre">any()</span></code> or
<code class="docutils literal notranslate"><span class="pre">all()</span></code> bracket which implies a loop over each array element. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>any(namelist:foo=bar == &#39;e&#39;)
</pre></div>
</div>
<p>evaluates true if <em>any</em> elements in the value of <code class="docutils literal notranslate"><span class="pre">bar</span></code> in the section
<code class="docutils literal notranslate"><span class="pre">namelist:foo</span></code> are <code class="docutils literal notranslate"><span class="pre">'e'</span></code>. For the above configuration snippet, this
would be expanded before evaluation to be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;a&#39; == &#39;e&#39; or &#39;b&#39; == &#39;e&#39; or &#39;c&#39; == &#39;e&#39; or &#39;d&#39; == &#39;e&#39;
</pre></div>
</div>
<p>Similarly,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>all(namelist:foo=bar == &#39;e&#39;)
</pre></div>
</div>
<p>evaluates true if <em>all</em> elements are <code class="docutils literal notranslate"><span class="pre">'e'</span></code>. Again, with the above
configuration, this would be expanded before proper evaluation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;a&#39; == &#39;e&#39; and &#39;b&#39; == &#39;e&#39; and &#39;c&#39; == &#39;e&#39; and &#39;d&#39; == &#39;e&#39;
</pre></div>
</div>




</article>
<article class="slide level-3" id="internals">

<h3>Internals<a class="headerlink" href="../../../html/api/configuration/metadata.html#internals" title="View HTML">§</a></h3>

<p>Rose uses an external engine to evaluate the raw language string after
variable IDs and any <code class="docutils literal notranslate"><span class="pre">any()</span></code> and <code class="docutils literal notranslate"><span class="pre">all()</span></code> functions have been substituted
and expanded.</p>
<p>The current choice of engine is <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>, which is responsible for the
details of the supported Pythonic syntax. This may change.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Do not</strong> use any Jinja2-specific syntax.</p>
</div>




</article>
<article class="slide level-2" id="config-editor-ignored-mechanics">

<h2>Config Editor Ignored Mechanics<a class="headerlink" href="../../../html/api/configuration/metadata.html#config-editor-ignored-mechanics" title="View HTML">§</a></h2>

<p>This describes the intended behaviour of <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> when
there is an ignored state mismatch for a setting - e.g. a setting might be
enabled when it should be trigger-ignored.</p>
<p><a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> differs from the strict command line macro
equivalent (<a class="reference internal" href="../command-reference.html#command-rose-macro"><span class="std std-ref">rose macro</span></a>)
because the <em>Switch Off Metadata</em> mode and accidentally metadata-less
configurations need to be presented in a nice way without lots of
unnecessary errors. <a class="reference internal" href="../command-reference.html#command-rose-config-edit"><span class="std std-ref">rose config-edit</span></a> should only report the
errors where the state is definitely wrong or makes a material difference to
the user.</p>
<p>The table contains error and fixing information for some varieties of
ignored state mismatches. The actual situations are considerably more
varied, given section-ignoring and latent variables - the table holds
the most important varieties.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">State</span></code> contains the actual states. The <code class="docutils literal notranslate"><span class="pre">Trigger</span> <span class="pre">State</span></code> column
contains the trigger-mechanism’s expected states. The states can be:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">IT</span></code> - <code class="docutils literal notranslate"><span class="pre">!!</span></code></dt>
<dd>trigger ignored</dd>
<dt><code class="docutils literal notranslate"><span class="pre">IU</span></code> - <code class="docutils literal notranslate"><span class="pre">!</span></code></dt>
<dd>user ignored</dd>
<dt><code class="docutils literal notranslate"><span class="pre">E</span></code> - <strong>(normal)</strong></dt>
<dd>enabled</dd>
</dl>
<p>A subset of possible ignored/enabled states, errors and fixes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="23%" />
<col width="15%" />
<col width="22%" />
<col width="18%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">State</th>
<th class="head">Trigger State</th>
<th class="head">Compulsory</th>
<th class="head">Display Error?</th>
<th class="head">User Options</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>compulsory</td>
<td>no</td>
<td>None</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>optional</td>
<td>no</td>
<td>None</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>compulsory</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>optional</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>compulsory</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>optional</td>
<td>overlook</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>See <a class="footnote-reference" href="#id3" id="id1">[1]</a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>compulsory</td>
<td>overlook</td>
<td>None</td>
<td>See <a class="footnote-reference" href="#id4" id="id2">[2]</a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>optional</td>
<td>no</td>
<td>None</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>compulsory</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>optional</td>
<td>no</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>compulsory</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>optional</td>
<td>no</td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>compulsory</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>optional</td>
<td>error</td>
<td><code class="docutils literal notranslate"><span class="pre">IT</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>compulsory</td>
<td>no</td>
<td>None</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td>optional</td>
<td>no</td>
<td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>compulsory</td>
<td>no</td>
<td>None</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">E</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">trigger</span></code></td>
<td>optional</td>
<td>no</td>
<td><code class="docutils literal notranslate"><span class="pre">IU</span></code></td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Overlooking mainly in order to de-clutter the <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">Metadata</span></code> view.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Same basic state - macro will ask to fix this.</td></tr>
</tbody>
</table>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>