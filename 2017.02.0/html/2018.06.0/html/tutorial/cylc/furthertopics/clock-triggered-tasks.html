



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Clock Triggered Tasks &mdash; Rose Documentation 2018.06.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/css/rtd-theme-fix.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Rose Documentation 2018.06.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Further Topics" href="index.html"/>
        <link rel="next" title="Broadcast" href="broadcast.html"/>
        <link rel="prev" title="Further Topics" href="index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Rose Documentation
          

          
          </a>

          
            
            
              <div class="version">
                2018.06.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Cylc Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduling/index.html">Scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../runtime/index.html">Runtime</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Further Topics</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Clock Triggered Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clock-triggering">Clock Triggering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clock-triggering-tasks">Clock-Triggering Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-more-clock-triggered-tasks">Adding More Clock-Triggered Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="broadcast.html">Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="family-triggers.html">Family Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="queues.html">Queues</a></li>
<li class="toctree-l3"><a class="reference internal" href="retries.html">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="suicide-triggers.html">Suicide Triggers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rose/index.html">Rose Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cheat-sheet.html">Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Rose API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/configuration/index.html">Rose Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/command-reference.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/environment-variables.html">Rose Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-bash-library.html">Rose Bash Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-built-in-applications.html">Rose Built-In Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-gtk-library.html">Rose GTK library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-macro.html">Rose Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rose-upgrader-macros.html">Rose Upgrade Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/rosie-web.html">Rosie Web API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../terms.html">Rose Terms Of Use</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Rose Documentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Cylc Tutorial</a> &raquo;</li>
        
          <li><a href="index.html">Further Topics</a> &raquo;</li>
        
      <li>Clock Triggered Tasks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="clock-triggered-tasks">
<span id="tutorial-cylc-clock-trigger"></span><h1>Clock Triggered Tasks<a class="headerlink" href="#clock-triggered-tasks" title="Permalink to this headline">¶</a></h1>
<p>In a <a class="reference internal" href="../../../glossary.html#term-datetime-cycling"><span class="xref std std-term">datetime cycling</span></a> suite the time represented by the
<a class="reference internal" href="../../../glossary.html#term-cycle-point"><span class="xref std std-term">cycle points</span></a> bear no relation to the real-world time.
Using clock-triggers we can make tasks wait until their cycle point time before
running.</p>
<p>Clock-triggering effectively enables us to tether the “cycle time” to the
“real world time” which we refer to as the <a class="reference internal" href="../../../glossary.html#term-wall-clock-time"><span class="xref std std-term">wall-clock time</span></a>.</p>
<div class="section" id="clock-triggering">
<h2>Clock Triggering<a class="headerlink" href="#clock-triggering" title="Permalink to this headline">¶</a></h2>
<p>When clock-triggering tasks we can use different
<a class="reference internal" href="../scheduling/datetime-cycling.html#tutorial-iso8601-durations"><span class="std std-ref">offsets</span></a> to the cycle time as follows:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> taskname(CYCLE_OFFSET)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regardless of the offset used, the task still belongs to the cycle from
which the offset has been applied.</p>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Our example suite will simulate a clock chiming on the hour.</p>
<p>Within your <code class="docutils literal notranslate"><span class="pre">~/cylc-run</span></code> directory create a new directory called
<code class="docutils literal notranslate"><span class="pre">clock-trigger</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/</span><span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/</span><span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<p>Paste the following code into a <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> file:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[cylc]</span>
    <span class="nv">UTC mode </span><span class="o">=</span><span class="s"> True</span> <span class="c1"># Ignore DST</span>

<span class="nt">[scheduling]</span>
    <span class="nv">initial cycle point </span><span class="o">=</span><span class="s"> TODO</span>
    <span class="nv">final cycle point </span><span class="o">=</span><span class="s"> +P1D</span> <span class="c1"># Run for one day</span>
    <span class="nt">[[dependencies]]</span>
        <span class="nt">[[[PT1H]]]</span>
            <span class="nv">graph</span><span class="s"> </span><span class="o">=</span> <span class="kd">bell</span>

<span class="nt">[runtime]</span>
    <span class="nt">[[root]]</span>
        <span class="nt">[[[events]]]</span>
            <span class="nv">mail events </span><span class="o">=</span><span class="s"> failed</span>
    <span class="nt">[[bell]]</span>
        <span class="nv">env-script </span><span class="o">=</span><span class="s"> eval $(rose task-env)</span>
        <span class="nv">script </span><span class="o">=</span><span class="s"> printf &#39;bong%.0s\n&#39; $(seq 1 $(cylc cyclepoint --print-hour))</span>
</pre></div>
</div>
<p>Change the initial cycle point to 00:00 this morning (e.g. if it was
the first of January 2000 we would write <code class="docutils literal notranslate"><span class="pre">2000-01-01T00Z</span></code>).</p>
<p>We now have a simple suite with a single task that prints “bong” a number
of times equal to the (cycle point) hour.</p>
<p>Run your suite using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">run</span> <span class="n">clock</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<p>Stop the suite after a few cycles using the <span class="guilabel">stop</span> button in the
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gui</span></code>. Notice how the tasks run as soon as possible rather than
waiting for the actual time to be equal to the cycle point.</p>
</div>
<div class="section" id="clock-triggering-tasks">
<h2>Clock-Triggering Tasks<a class="headerlink" href="#clock-triggering-tasks" title="Permalink to this headline">¶</a></h2>
<p>We want our clock to only ring in real-time rather than the simulated
cycle time.</p>
<p>To do this, add the following lines to the <code class="docutils literal notranslate"><span class="pre">[scheduling]</span></code> section of
your <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code>:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[special tasks]]</span>
    <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> bell(PT0M)</span>
</pre></div>
</div>
<p>This tells the suite to clock trigger the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task with a cycle
offset of <code class="docutils literal notranslate"><span class="pre">0</span></code> hours.</p>
<p>Save your changes and run your suite.</p>
<p>Your suite should now be running the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task in real-time. Any cycle times
that have already passed (such as the one defined by <code class="docutils literal notranslate"><span class="pre">initial</span> <span class="pre">cycle</span> <span class="pre">time</span></code>)
will be run as soon as possible, while those in the future will wait for that
time to pass.</p>
<p>At this point you may want to leave your suite running until the next hour
has passed in order to confirm the clock triggering is working correctly.
Once you are satisfied, stop your suite.</p>
<p>By making the <code class="docutils literal notranslate"><span class="pre">bell</span></code> task a clock triggered task we have made it run in
real-time. Thus, when the wall-clock time caught up with the cycle time, the
<code class="docutils literal notranslate"><span class="pre">bell</span></code> task triggered.</p>
</div>
<div class="section" id="adding-more-clock-triggered-tasks">
<h2>Adding More Clock-Triggered Tasks<a class="headerlink" href="#adding-more-clock-triggered-tasks" title="Permalink to this headline">¶</a></h2>
<p>We will now modify our suite to run tasks at quarter-past, half-past and
quarter-to the hour.</p>
<p>Open your <code class="docutils literal notranslate"><span class="pre">suite.rc</span></code> and modify the <code class="docutils literal notranslate"><span class="pre">[runtime]</span></code> section by adding the
following:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[quarter_past, half_past, quarter_to]]</span>
    <span class="nv">script </span><span class="o">=</span><span class="s"> echo &#39;chimes&#39;</span>
</pre></div>
</div>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">[[scheduling]]</span></code> section to read:</p>
<div class="highlight-cylc notranslate"><div class="highlight"><pre><span></span><span class="nt">[[special tasks]]</span>
    <span class="nv">clock-trigger </span><span class="o">=</span><span class="s"> bell(PT0M), quarter_past(PT15M), half_past(PT30M), quarter_to(PT45M)</span>
<span class="nt">[[dependencies]]</span>
    <span class="nt">[[[PT1H]]]</span>
        <span class="nv">graph</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
            <span class="kd">bell</span>
            <span class="kd">quarter_past</span>
            <span class="kd">half_past</span>
            <span class="kd">quarter_to</span>
        <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note the different values used for the cycle offsets of the clock-trigger tasks.</p>
<p>Save your changes and run your suite using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cylc</span> <span class="n">run</span> <span class="n">clock</span><span class="o">-</span><span class="n">trigger</span> <span class="n">now</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">now</span></code> argument will run your suite using the current time for the
initial cycle point.</p>
</div>
<p>Again, notice how the tasks trigger until the current time is reached.</p>
<p>Leave your suite running for a while to confirm it is working as expected
and then shut it down using the <span class="guilabel">stop</span> button in the <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">gui</span></code>.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Clock triggers are a type of <a class="reference internal" href="../../../glossary.html#term-dependency"><span class="xref std std-term">dependency</span></a> which cause
<a class="reference internal" href="../../../glossary.html#term-task"><span class="xref std std-term">tasks</span></a> to wait for the <a class="reference internal" href="../../../glossary.html#term-wall-clock-time"><span class="xref std std-term">wall-clock time</span></a> to reach the
<a class="reference internal" href="../../../glossary.html#term-cycle-point"><span class="xref std std-term">cycle point</span></a> time.</li>
<li>A clock trigger applies only to a single task.</li>
<li>Clock triggers can only be used in datetime cycling suites.</li>
</ul>
<p>For more information see the <a class="reference external" href="http://cylc.github.io/cylc/documentation.html#the-cylc-user-guide">Cylc User Guide</a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="broadcast.html" class="btn btn-neutral float-right" title="Broadcast" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Further Topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright : British Crown Copyright 2012-8 Met Office. See Terms of Use. This document is released under the Open Government Licence.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Read the Docs</span>
    v: 2018.06.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions" id="version-selector">
    <script type="text/javascript">
        // NOTE: temporary variables not initiated so that they can be deleted

        // path to a root file in the current version of the documentation
        version_path = "../../../.html".split('/');
        // dirname of the root dir
        version_dir = version_path
            .splice(0, version_path.length - 1)
            .join('/');
        delete version_path;
        // relative path from the current version to the documentation root
        rel_path = '../../';
        // relative path from the current document to the documentation root
        var root_dir;
        if (version_dir) {
            root_dir = version_dir + '/' + rel_path;
        } else {
            root_dir = rel_path;
        }
        delete version_dir;
        delete rel_path;
        // the name of the current version of the documentation
        const current_version = "2018.06.0";
        // the name of the builder (i.e. html)
        const current_builder = "html";
        // the name of the current page
        const current_page_name = "tutorial/cylc/furthertopics/clock-triggered-tasks";
    </script>
  </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'2018.06.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/js/minicylc.js"></script>
      <script type="text/javascript" src="../../../_static/js/spoiler.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../../_static/js/rtd-theme-extensions.js"></script>
      <script type="text/javascript" src="../../../_static/js/versioning.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>